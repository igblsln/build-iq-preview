"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[416],{2416:function(e,t,n){n.d(t,{h:function(){return _},Z:function(){return W}});var r=n(969),o=n(3026),a=n(3668),i=n(6234),c=n(7765),u=n(8301),l=n(8224),s=n(4756),d=n(3127),m=n(4320),p=n(7416),f=n(9810),y=n(8079),g=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},v="/transaction/purchase/order/",T=f.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listTransaction:e.query({query:function(e){var t=e.page,n=e.size;return{url:(0,f.DS)(v,"?page=".concat(t||1,"&page_size=").concat(n||f.IV))}},providesTags:function(e){var t;return e?[].concat((0,y.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.key;return{type:f.pJ.TRANSACTION,key:t}}))),[{type:f.pJ.TRANSACTION,id:"LIST"}]):[{type:f.pJ.TRANSACTION,id:"LIST"}]}}),addTransaction:e.mutation({query:function(e){return{url:v,method:"POST",body:e}},invalidatesTags:[{type:f.pJ.TRANSACTION,id:"LIST"}]}),getTransaction:e.query({query:function(e){return"".concat(v).concat(e)},providesTags:function(e,t,n){return[{type:f.pJ.TRANSACTION,id:n}]}}),getTransactionNextDocId:e.query({query:function(e){return"".concat("/transaction/doc/id/","next?docid=").concat(e)},providesTags:function(e,t){return[]}}),updateTransaction:e.mutation({query:function(e){var t=e.key,n=g(e,["key"]);return{url:"".concat(v).concat(t),method:"PUT",body:n}},invalidatesTags:function(e){var t;return[{type:f.pJ.TRANSACTION,id:null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.key}]}}),deleteTransaction:e.mutation({query:function(e){return{url:"".concat(v).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:f.pJ.TRANSACTION,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),b=T.useAddTransactionMutation,h=T.useDeleteTransactionMutation,E=T.useGetTransactionQuery,N=T.useListTransactionQuery,I=T.useUpdateTransactionMutation,S=(T.useGetErrorProneQuery,T.useGetTransactionNextDocIdQuery),_=(T.endpoints.getTransaction,"materialpurchase"),L="Material Purchase",P={purchase:"GR2",inventory:"GR3",projects:"GR1"},R=n(6666),w=n(6770),x="/transaction/purchase/order/items/",A=f.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listTransactionItem:e.query({query:function(e){var t=e.page,n=e.size;return{url:(0,f.DS)(x,"?page=".concat(t||1,"&page_size=").concat(n||f.IV))}},providesTags:function(e){var t;return e?[].concat((0,y.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.item_key;return{type:f.pJ.TRANSACTION_ITEM,item_key:t}}))),[{type:f.pJ.TRANSACTION_ITEM,id:"LIST"}]):[{type:f.pJ.TRANSACTION_ITEM,id:"LIST"}]}}),addTransactionItems:e.mutation({query:function(e){return{url:x,method:"POST",body:e}},invalidatesTags:[{type:f.pJ.TRANSACTION_ITEM,id:"LIST"},{type:f.pJ.TRANSACTION,id:"LIST"}]}),getTransactionItem:e.query({query:function(e){return"".concat(x).concat(e)},providesTags:function(e,t,n){return[{type:f.pJ.TRANSACTION_ITEM,id:n}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),O=A.useAddTransactionItemsMutation,k=(A.useGetTransactionItemQuery,A.useListTransactionItemQuery,A.useGetErrorProneQuery,A.endpoints.getTransactionItem,(0,r.forwardRef)((function(e,t){var n=e.moduleName,o=e.data,a=e.isLoading,c=(0,r.useState)([]),u=(0,i.Z)(c,2),s=u[0],d=u[1],m=O(),y=(0,i.Z)(m,2),g=(y[0],y[1].isLoading),v=(0,r.useRef)(s),T=(0,r.useRef)([]),b=(0,r.useRef)([]),h=(0,f.Zp)({}),E=h.data,N=(h.isLoading,(0,f.DY)({})),I=N.data;N.isLoading;(0,r.useImperativeHandle)(t,(function(){return{getItems:function(){return s}}})),(0,r.useEffect)((function(){d(o),v.current=o}),[o]),(0,r.useEffect)((function(){T.current=(null===E||void 0===E?void 0:E.results)||[],b.current=(null===I||void 0===I?void 0:I.results)||[]}),[E,I]);var S=function(e){return r.createElement(p.JK,{value:e||0})};return r.createElement(p.PS,{baseRoute:"/".concat(n,"/").concat(_),description:L,isLoading:a||g,data:s,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,actionBodyTemplate:function(e){return r.createElement(w.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=v.current.filter((function(t){return t!==e}));v.current=t,d(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!0,newRowDefaults:{netamt:0,taxamt:0,totalamt:0},OnRowsChanged:function(e){d(e),v.current=e},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0),taxamt:e.map((function(e){return parseFloat(e.taxamt||0)})).reduce((function(e,t){return e+t}),0),totalamt:e.map((function(e){return parseFloat(e.totalamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},r.createElement(p._P,{field:"item_key",displayField:"items.descr",header:"Item",editorType:function(e){var t=e.row,n=e.column,o=e.onRowChange;e.onClose;return r.createElement(l.L,{autoFocus:!0,className:"p-inputtext-sm editor-dropdown-style",value:t[n.key],optionLabel:"descr",optionValue:"key",options:T.current,onChange:function(e){console.log("getOptionsEditor-onChange",e,n,t),t[n.key]=e.value,t.items=T.current.find((function(t){return t.key===e.value})),o(t,!0)},tabIndex:-1})}}),r.createElement(p._P,{field:"itemuom_key",displayField:"items_uoms.descr",header:"UOM",editorType:function(e){var t=e.row,n=e.column,o=e.onRowChange;e.onClose;return r.createElement(l.L,{autoFocus:!0,className:"p-inputtext-sm editor-dropdown-style",value:t[n.key],optionLabel:"descr",optionValue:"key",options:b.current,onChange:function(e){console.log("getOptionsEditor-onChange",e,Object.assign(Object.assign({},t),(0,R.Z)({},n.key,e.value))),t[n.key]=e.value,t.items_uoms=b.current.find((function(t){return t.key===e.value})),o(t,!0)},tabIndex:-1})}}),r.createElement(p._P,{field:"qty",header:"Quantiy",type:"number",editorType:"number"}),r.createElement(p._P,{field:"unitprice",header:"Unit Price",type:"number",editorType:"number"}),r.createElement(p._P,{field:"netamt",header:"Net Amt",type:"currency",defaultValue:0,editorType:"currency",summaryFormatter:function(e){var t=e.row;return S(null===t||void 0===t?void 0:t.netamt)}}),r.createElement(p._P,{field:"taxamt",header:"Tax Amt",type:"currency",defaultValue:0,editorType:"currency",summaryFormatter:function(e){var t=e.row;return S(null===t||void 0===t?void 0:t.taxamt)}}),r.createElement(p._P,{field:"totalamt",header:"Total Amt",type:"currency",defaultValue:0,editorType:"currency",summaryFormatter:function(e){var t=e.row;return S(null===t||void 0===t?void 0:t.totalamt)}}))}))),C=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(t){a(t)}}function c(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},j=function(e,t){return e?t?"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()):new Date(e):e},q=function(e){var t=e.moduleName,n=(0,p.pm)(),y=n.showSuccess,g=n.showError,v=(0,r.useState)(!1),T=(0,i.Z)(v,2),h=T[0],N=T[1],R=(0,r.useState)({}),w=(0,i.Z)(R,2),x=w[0],A=w[1],O=(0,o.UO)().id,q=parseInt(O||""),F=isNaN(q)||q<=0,W=(0,r.useRef)(),D=E(q,{skip:F}),J=D.data,V=D.isLoading,G=D.refetch,Z=S(P[t],{skip:!F}),M=Z.data,Q=Z.isLoading,B=(0,o.s0)(),U=(0,f.JB)(),z=U.data,H=U.isLoading,Y=(0,f.Wv)(),$=Y.data,K=Y.isLoading,X=I(),ee=(0,i.Z)(X,2),te=ee[0],ne=ee[1].isLoading,re=b(),oe=(0,i.Z)(re,2),ae=oe[0],ie=oe[1].isLoading;(0,r.useEffect)((function(){A(J||Object.assign(Object.assign({},f.Y$),{date:j(new Date,!0),docid:P[t],number:null===M||void 0===M?void 0:M.next_doc_id,loctyp:"projects"===t?"PR":"inventory"===t?"WH":""}))}),[J,M]);var ce=[{label:"Save & Submit",icon:"pi pi-check",command:function(){console.log("Submit")}},{label:"Cancel",icon:"pi pi-times",command:function(){console.log("Cancel")}}];return r.createElement(r.Fragment,null,r.createElement(p.Rm,{baseRoute:"/".concat(t,"/").concat(_),description:L,id:q,data:x,saveButton:r.createElement(m.a,{label:"Save",style:{paddingRight:20},buttonProps:{type:"submit"},menuClassName:"save-menu-item",className:"p-button-warning mr-3",model:ce}),moreSubmitItems:r.createElement(r.Fragment,null),isUpdating:ie||ne||h,isLoading:V,onSubmit:function(e){return C(void 0,void 0,void 0,(0,a.Z)().mark((function n(){var r,o,i;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=null===(r=W.current)||void 0===r?void 0:r.getItems(),console.log("submit",e,o),n.prev=2,!F){n.next=9;break}return n.next=6,ae(Object.assign(Object.assign(Object.assign({},e),{purchs_odr_items:o}),f.Y$)).unwrap();case 6:i=n.sent,n.next=12;break;case 9:return n.next=11,te(Object.assign(Object.assign(Object.assign({},e),{purchs_odr_items:o}),f.Y$)).unwrap();case 11:i=n.sent;case 12:console.log("submit resp",i),G(),y("Success",i.detail),N(!0),setTimeout((function(){B("/".concat(t,"/").concat(_))}),3e3),n.next=22;break;case 19:n.prev=19,n.t0=n.catch(2),g("An error occurred","We couldn't save your post, try again!");case 22:case"end":return n.stop()}}),n,null,[[2,19]])})))},renderForm:function(e,n,o){return r.createElement("div",{className:"pl-4 pt-4 grid p-fluid h-full"},r.createElement("div",{className:"col-12 md:col-6 grid grid-nogutter p-fluid",style:{alignContent:"flex-start"}},r.createElement(p.Wi,{label:"Doc ID",name:"docid",className:(0,s.AK)("col-12 md:col-6"),control:e,errors:o,formItem:{component:c.o,componentProps:{disabled:!0}}}),"purchase"===t&&r.createElement(p.Wi,{label:"Type",name:"loctyp",className:"col-12 md:col-6",centerText:!0,control:e,errors:o,formItem:{component:l.L,componentProps:{optionLabel:"name",optionValue:"id",options:[{name:"Project",id:"PR"},{name:"Warehouse",id:"WH"}]}}})),r.createElement(p.Wi,{label:"GRN Number",name:"number",isLoading:Q,className:"col-12 md:col-6",control:e,errors:o,formItem:{component:u.R,componentProps:{useGrouping:!1,disabled:!0}}}),r.createElement(p.Wi,{label:"Project",name:"proj_key",className:"col-12 md:col-6",control:e,errors:o,isLoading:H,leftSpan:3,rightSpan:9,formItem:{component:l.L,componentProps:{optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:z}}}),r.createElement(p.Wi,{label:"GRN Date",name:"date",className:"col-12 md:col-6",useExplicit:!0,control:e,errors:o,convertValue:j,formItem:{component:d.f,componentProps:{showIcon:!0,dateFormat:"yy-mm-dd"}}}),r.createElement(p.Wi,{label:"Vendor",name:"vend_key",className:"col-12 md:col-6",control:e,errors:o,isLoading:K,leftSpan:3,rightSpan:9,formItem:{component:l.L,componentProps:{optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:$}}}),r.createElement(p.Wi,{label:"Vendor RefNo",name:"vend_ref_no",className:"col-12 md:col-6",control:e,errors:o,formItem:{component:c.o,componentProps:{maxLength:25}}}),r.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},r.createElement(k,{data:(null===J||void 0===J?void 0:J.purchs_odr_items)||[],isLoading:V,moduleName:t,ref:W})))}}))},F=function(e){var t=e.moduleName,n=N({}),o=n.data,a=n.isLoading,c=h(),u=(0,i.Z)(c,2),l=u[0],s=u[1].isLoading;return r.createElement(p.PS,{baseRoute:"/".concat(t,"/").concat(_),description:L,isLoading:a||s,newTable:!0,showHeader:!0,data:null===o||void 0===o?void 0:o.results,deleteAction:function(e){return l(e).unwrap()}},r.createElement(p._P,{field:"number",header:"GRN Number",filteringType:"number"}),r.createElement(p._P,{field:"date",header:"GRN Date",filteringType:"text"}),r.createElement(p._P,{field:"project.name",header:"Project",filteringType:"text"}),r.createElement(p._P,{field:"vendor.name",header:"Vendor",filteringType:"text"}),r.createElement(p._P,{field:"vendtyp_key",header:"Vendor RefNo",filteringType:"text"}),r.createElement(p._P,{field:"docstatus",header:"GRN Status",filteringType:"text"}))},W=function(e){return r.createElement(o.AW,{path:_},r.createElement(o.AW,{path:"new",element:r.createElement(q,{moduleName:e})}),r.createElement(o.AW,{path:":id/edit",element:r.createElement(q,{moduleName:e})}),r.createElement(o.AW,{index:!0,element:r.createElement(F,{moduleName:e})}))}}}]);
//# sourceMappingURL=416.d841d710.chunk.js.map