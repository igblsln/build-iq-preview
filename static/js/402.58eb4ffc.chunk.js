"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[402],{402:function(e,t,n){n.d(t,{h:function(){return x},Z:function(){return C}});var r=n(969),a=n(734),o=n(2723),i=n(6234),c=n(7765),u=n(8301),l=n(8224),s=n(3127),d=n(6770),m=n(4576),p=n(55),f=n(6593),v=n(8079),g="/transaction/goods/receipts/",y=f.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listTransaction:e.query({query:function(e){var t=e.page,n=e.size,r=e.grn;return{url:r?(0,f.DS)(g,"?page=".concat(t||1,"&page_size=").concat(n||f.IV,"&docid=").concat(r)):(0,f.DS)(g,"?page=".concat(t||1,"&page_size=").concat(n||f.IV))}},providesTags:function(e){var t;return e?[].concat((0,v.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.key;return{type:f.pJ.TRANSACTION,key:t}}))),[{type:f.pJ.TRANSACTION,id:"LIST"}]):[{type:f.pJ.TRANSACTION,id:"LIST"}]}}),addTransaction:e.mutation({query:function(e){return{url:"".concat(g),method:"POST",body:e}},invalidatesTags:[{type:f.pJ.TRANSACTION,id:"LIST"}]}),getTransaction:e.query({query:function(e){return"".concat(g).concat(e)},providesTags:function(e,t,n){return[{type:f.pJ.TRANSACTION,id:n}]}}),getTransactionNextDocId:e.query({query:function(e){return"".concat("/transaction/doc/id/","next?docid=").concat(e)},providesTags:function(e,t){return[]}}),updateTransaction:e.mutation({query:function(e){var t=e;return{url:"".concat(g),method:"POST",body:t}},invalidatesTags:function(e){var t;return[{type:f.pJ.TRANSACTION,id:null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.key}]}}),deleteTransaction:e.mutation({query:function(e){return{url:"".concat(g).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:f.pJ.TRANSACTION,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),b=y.useAddTransactionMutation,h=y.useDeleteTransactionMutation,T=y.useGetTransactionQuery,E=y.useListTransactionQuery,S=y.useUpdateTransactionMutation,N=(y.useGetErrorProneQuery,y.useGetTransactionNextDocIdQuery),x=(y.endpoints.getTransaction,"materialpurchase"),I="Material Received",k={purchase:"GR2",inventory:"GR3",projects:"GR1"},w=(0,r.forwardRef)((function(e,t){var n,a=e.moduleName,o=e.data,c=e.isLoading,u=e.disableTable,s=void 0!==u&&u,m=e.onChange,v=void 0===m?function(){}:m,g=(0,r.useState)([]),y=(0,i.Z)(g,2),b=y[0],h=y[1],T=(0,f.nq)("admin"),E=T.data,S=(T.isLoading,E&&(null===(n=E[0])||void 0===n?void 0:n.user)),N=(0,r.useRef)(b),k=(0,r.useRef)([]),w=(0,r.useRef)([]),L=(0,f.Zp)({}),R=L.data,_=(L.isLoading,(0,f.DY)({})),A=_.data;_.isLoading;(0,r.useImperativeHandle)(t,(function(){return{getItems:function(){return b}}})),(0,r.useEffect)((function(){h(o),N.current=o}),[o]),(0,r.useEffect)((function(){k.current=(null===R||void 0===R?void 0:R.results)||[],w.current=(null===A||void 0===A?void 0:A.results)||[]}),[R,A]);var C=function(e){return r.createElement(p.JK,{value:e||0})},P=function(){return"projects"!==a||3===S};return r.createElement(p.PS,{baseRoute:"/".concat(a,"/").concat(x),description:I,isLoading:c,data:b,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,hideActionColumn:s,actionBodyTemplate:function(e){return r.createElement(d.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=N.current.filter((function(t){return t!==e}));N.current=t,h(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!0,disableAdd:s||!(0,f.pH)(b),newRowDefaults:{netamt:0,taxamt:0,totalamt:0},OnRowsChanged:function(e){var t=e.map((function(e){return Object.assign(Object.assign({},e),{netamt:e.qty*e.unitprice,totalamt:e.qty*e.unitprice+e.taxamt})}));h(t),N.current=t,v(!0)},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0),taxamt:e.map((function(e){return parseFloat(e.taxamt||0)})).reduce((function(e,t){return e+t}),0),totalamt:e.map((function(e){return parseFloat(e.totalamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},r.createElement(p._P,{field:"item_key",header:"Item*",displayValueGetter:function(e,t){var n,r;if(!Array.isArray(e)){var a=null===(n=k.current)||void 0===n?void 0:n.filter((function(n){return n.key===e[t]}));return a.length?a[0].descr:null===(r=null===e||void 0===e?void 0:e.items)||void 0===r?void 0:r.descr}},editorType:!s&&function(e){var t=e.row,n=e.column,a=e.onRowChange;e.onClose;return r.createElement(l.L,{autoFocus:!0,className:"p-inputtext-sm editor-dropdown-style",value:t[n.key],optionLabel:"descr",optionValue:"key",filter:!0,filterBy:"descr",options:k.current,onChange:function(e){var r=Object.assign({},t);r[n.key]=e.value,r.items=w.current.find((function(t){return t.key===e.value})),a(r,!0)},tabIndex:-1})}}),r.createElement(p._P,{field:"itemuom_key",header:"UOM*",displayValueGetter:function(e,t){var n,r;if(!Array.isArray(e)){var a=null===(n=w.current)||void 0===n?void 0:n.filter((function(n){return n.key===e[t]}));return a.length?a[0].descr:null===(r=null===e||void 0===e?void 0:e.items_uoms)||void 0===r?void 0:r.descr}},editorType:!s&&function(e){var t=e.row,n=e.column,a=e.onRowChange;e.onClose;return r.createElement(l.L,{autoFocus:!0,className:"p-inputtext-sm editor-dropdown-style",value:t[n.key],optionLabel:"descr",optionValue:"key",filter:!0,filterBy:"descr",options:w.current,onChange:function(e){var r=Object.assign({},t);r[n.key]=e.value,r.items_uoms=w.current.find((function(t){return t.key===e.value})),a(r,!0)},tabIndex:-1})}}),r.createElement(p._P,{field:"qty",header:"Quantity",type:"number",editorType:!s&&"number"}),P()&&r.createElement(p._P,{field:"unitprice",header:"Unit Price",type:"number",editorType:!s&&"number"}),P()&&r.createElement(p._P,{field:"netamt",header:"Net Amt",type:"currency",defaultValue:0,summaryFormatter:function(e){var t=e.row;return C(null===t||void 0===t?void 0:t.netamt)}}),P()&&r.createElement(p._P,{field:"taxamt",header:"Tax Amt",type:"currency",defaultValue:0,editorType:!s&&"currency",summaryFormatter:function(e){var t=e.row;return C(null===t||void 0===t?void 0:t.taxamt)}}),P()&&r.createElement(p._P,{field:"totalamt",header:"Total Amt",type:"currency",defaultValue:0,summaryFormatter:function(e){var t=e.row;return C(null===t||void 0===t?void 0:t.totalamt)}}))})),L=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(t){o(t)}}function c(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},R=function(e,t){return e?t?"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()):new Date(e):e},_=function(e){var t=e.moduleName,n=(0,p.pm)(),v=n.showSuccess,g=n.showError,y=(0,r.useState)(!1),h=(0,i.Z)(y,2),E=h[0],_=h[1],A=(0,r.useState)({}),C=(0,i.Z)(A,2),P=C[0],O=C[1],j=(0,a.UO)().id,V=parseInt(j||""),q=isNaN(V)||V<=0,Z=(0,r.useState)(!1),D=(0,i.Z)(Z,2),F=D[0],W=D[1],G=(0,r.useState)("S"),U=(0,i.Z)(G,2),B=U[0],M=U[1],J=(0,r.useState)("SAVE"),H=(0,i.Z)(J,2),Y=H[0],z=H[1],Q=(0,r.useState)(null),$=(0,i.Z)(Q,2),K=$[0],X=$[1],ee=(0,r.useState)(null),te=(0,i.Z)(ee,2),ne=te[0],re=te[1],ae=(0,r.useRef)(),oe=(0,r.useRef)(),ie=T(V,{skip:q}),ce=ie.data,ue=ie.isLoading,le=ie.refetch,se=N(k[t],{skip:!q}),de=se.data,me=se.isLoading,pe=(0,a.s0)(),fe=(0,f.JB)(),ve=fe.data,ge=fe.isLoading,ye=(0,f.Wv)(),be=ye.data,he=ye.isLoading,Te=(0,f.es)({vendor:K,project:ne},{skip:!ne||!K}),Ee=Te.data,Se=Te.isFetching,Ne=S(),xe=(0,i.Z)(Ne,2),Ie=xe[0],ke=xe[1].isLoading,we=b(),Le=(0,i.Z)(we,2),Re=Le[0],_e=Le[1].isLoading;(0,r.useEffect)((function(){O(ce||Object.assign(Object.assign({},f.Y$),{date:R(new Date,!0),docid:k[t],number:null===de||void 0===de?void 0:de.next_doc_id,loctyp:"projects"===t?"PR":"inventory"===t?"WH":""})),ce&&(re(ce.proj_key),X(ce.vend_key))}),[ce,de]);var Ae=(0,r.useState)(null),Ce=(0,i.Z)(Ae,2),Pe=Ce[0],Oe=Ce[1],je=(0,r.useState)([]),Ve=(0,i.Z)(je,2),qe=Ve[0],Ze=Ve[1],De=(0,f.dV)({id:Pe},{skip:!Pe}),Fe=De.data;De.isFetching;(0,r.useEffect)((function(){if(Fe)if(console.log(Fe),q)Ze(Fe);else{var e=(null===ce||void 0===ce?void 0:ce.grn_items.concat(Fe))||[];Ze(e)}}),[Fe]),(0,r.useEffect)((function(){ce&&Ze((null===ce||void 0===ce?void 0:ce.grn_items)||[])}),[ce]);var We=function(){return["U","R","I","C"].includes(null===ce||void 0===ce?void 0:ce.docstatus)},Ge=function(e,t){return L(void 0,void 0,void 0,(0,o.Z)().mark((function n(){var r;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,M(e);case 2:return n.next=4,z(t);case 4:null===(r=document.getElementById("submit"))||void 0===r||r.click();case 5:case"end":return n.stop()}}),n)})))};return r.createElement(r.Fragment,null,r.createElement(p.Rm,{baseRoute:"/".concat(t,"/").concat(x),description:I,id:V,data:P,isItemsTableChanged:F,ref:oe,moreSubmitItems:r.createElement(r.Fragment,null,r.createElement(d.z,{label:"Submit",style:{margin:"0 20px"},disabled:"S"!==(null===ce||void 0===ce?void 0:ce.docstatus),onClick:function(e){var t;e.preventDefault(),(null===(t=oe.current)||void 0===t?void 0:t.getIsDirty())||F?(0,m.V)({message:"Do you want to save the changes before submit?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){return Ge("U","SUBMIT_WITH_SAVE")},reject:function(){return Ge("U","SUBMIT_WITHOUT_SAVE")}}):Ge("U","SUBMIT_WITH_SAVE")}}),r.createElement(d.z,{label:"Cancel",disabled:q||["R","I","C"].includes(null===ce||void 0===ce?void 0:ce.docstatus),className:"p-button-plain",onClick:function(e){return z("CANCEL"),M("C"),!0}})),isUpdating:_e||ke||E,isLoading:ue,onSubmit:function(e){return L(void 0,void 0,void 0,(0,o.Z)().mark((function n(){var r,a,i;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=null===(r=ae.current)||void 0===r?void 0:r.getItems(),console.log("submit",e,a),n.prev=2,!q){n.next=9;break}return n.next=6,Re(Object.assign(Object.assign(Object.assign({},e),{action:Y,loctyp:"PR",docstatus:B,grn_items:null===a||void 0===a?void 0:a.map((function(e){return Object.assign(Object.assign({},e),f.Y$)}))}),f.Y$)).unwrap();case 6:i=n.sent,n.next=12;break;case 9:return n.next=11,Ie(Object.assign(Object.assign(Object.assign({},e),{action:Y,docstatus:B,grn_items:null===a||void 0===a?void 0:a.map((function(e){return Object.assign(Object.assign({},e),f.Y$)}))}),f.Y$)).unwrap();case 11:i=n.sent;case 12:console.log("submit resp",i),le(),v("Success",i.detail),_(!0),setTimeout((function(){pe("/".concat(t,"/").concat(x))}),f.P7),n.next=22;break;case 19:n.prev=19,n.t0=n.catch(2),g("An error occurred","We couldn't save your post, try again!");case 22:case"end":return n.stop()}}),n,null,[[2,19]])})))},renderForm:function(e,n,a){var o;return r.createElement("div",{className:"pl-4 pt-4 grid p-fluid h-full"},r.createElement(p.Wi,{label:"GRN Number",name:"number",isLoading:me,className:"col-12 md:col-6",control:e,errors:a,leftSpan:4,rightSpan:6,formItem:{component:u.R,componentProps:{useGrouping:!1,disabled:!0}}}),r.createElement(p.Wi,{label:"Project",name:"proj_key",className:"col-12 md:col-6",control:e,errors:a,required:"Select a Project",isLoading:ge,leftSpan:4,rightSpan:6,useExplicit:!0,onChange:function(e){re(e.value)},formItem:{component:l.L,componentProps:{optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:ve}}}),r.createElement(p.Wi,{label:"GRN Date",name:"date",className:"col-12 md:col-6",useExplicit:!0,control:e,errors:a,leftSpan:4,rightSpan:6,convertValue:R,formItem:{component:s.f,componentProps:{showIcon:!0,dateFormat:"yy-mm-dd"}}}),r.createElement(p.Wi,{label:"Vendor",name:"vend_key",className:"col-12 md:col-6",control:e,errors:a,isLoading:he,required:"Select a Vendor",leftSpan:4,rightSpan:6,useExplicit:!0,onChange:function(e){X(e.value)},formItem:{component:l.L,componentProps:{optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:be}}}),r.createElement(p.Wi,{label:"PO Number",name:"pono",className:"col-12 md:col-6",control:e,errors:a,leftSpan:4,rightSpan:6,isLoading:Se,useExplicit:!0,onChange:function(e){We()||Oe(e.value)},formItem:{component:l.L,componentProps:{optionLabel:"number",optionValue:"key",options:Ee}}}),r.createElement(p.Wi,{label:"Vendor RefNo",name:"vendrefno",className:"col-12 md:col-6",leftSpan:4,rightSpan:6,required:"Enter Ref No",control:e,errors:a,formItem:{component:c.o,componentProps:{maxLength:25}}}),r.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},r.createElement(w,{data:qe||(null===(o=ae.current)||void 0===o?void 0:o.getItems())||[],isLoading:ue,moduleName:t,ref:ae,disableTable:We(),onChange:function(e){return!F&&W(e)}})))}}))},A=function(e){var t=e.moduleName,n=E("purchase"!==t?{grn:k[t]}:{},{refetchOnMountOrArgChange:!0}),a=n.data,o=n.isLoading,c=h(),u=(0,i.Z)(c,2),l=u[0],s=u[1].isLoading;return r.createElement(p.PS,{baseRoute:"/".concat(t,"/").concat(x),description:I,isLoading:o||s,newTable:!0,showHeader:!0,data:null===a||void 0===a?void 0:a.results,deleteAction:function(e){return l(e).unwrap()}},r.createElement(p._P,{field:"number",header:"GRN Number",filteringType:"number"}),r.createElement(p._P,{field:"date",header:"GRN Date",filteringType:"text"}),r.createElement(p._P,{field:"project.name",header:"Project",filteringType:"text"}),r.createElement(p._P,{field:"vendor.name",header:"Vendor",filteringType:"text"}),r.createElement(p._P,{field:"vendrefno",header:"Vendor RefNo",filteringType:"text"}),r.createElement(p._P,{field:"status.descr",header:"GRN Status",filteringType:"text"}))},C=function(e){return r.createElement(a.AW,{path:x},r.createElement(a.AW,{path:"new",element:r.createElement(_,{moduleName:e})}),r.createElement(a.AW,{path:":id/edit",element:r.createElement(_,{moduleName:e})}),r.createElement(a.AW,{index:!0,element:r.createElement(A,{moduleName:e})}))}}}]);
//# sourceMappingURL=402.58eb4ffc.chunk.js.map