"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[526],{8526:function(e,t,n){n.r(t),n.d(t,{default:function(){return Y}});var r,o,a=n(969),i=n(734),l=n(910),c=n(4732),u="users",s="User",d=[{items:[{label:"User",icon:"pi ml-3",template:(r=u,(0,l.E7)("/".concat(c.o,"/").concat(r)+(o?"/comming-soon":""))),altUrls:"/users/roles"}]}],m=n(2723),p=n(6234),v=n(3953),f=n(7765),g=n(8224),y=n(8391),h=n(8079),E=n(1495),b=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},S="/user/",x=E.rj.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listUser:e.query({query:function(e){var t=e.page,n=e.size;return{url:"".concat(S,"?page=").concat(t||1,"&page_size=").concat(n||E.IV)}},providesTags:function(e){var t;return e?[].concat((0,h.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.id;return{type:E.pJ.USERS,id:t}}))),[{type:E.pJ.USERS,id:"LIST"}]):[{type:E.pJ.USERS,id:"LIST"}]}}),addUser:e.mutation({query:function(e){return{url:S,method:"POST",body:e}},invalidatesTags:[{type:E.pJ.USERS,id:"LIST"}]}),getUser:e.query({query:function(e){return"".concat(S).concat(e)},providesTags:function(e,t,n){return[{type:E.pJ.USERS,id:n}]}}),updateUser:e.mutation({query:function(e){var t=e.id,n=b(e,["id"]);return{url:"".concat(S).concat(t),method:"PUT",body:n}},invalidatesTags:function(e){return[{type:E.pJ.USERS,id:null===e||void 0===e?void 0:e.id}]}}),deleteUser:e.mutation({query:function(e){return{url:"".concat(S).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:E.pJ.USERS,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),w=x.useAddUserMutation,I=x.useDeleteUserMutation,P=x.useGetUserQuery,T=x.useListUserQuery,O=x.useUpdateUserMutation,L=(x.useGetErrorProneQuery,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}),k="/role/",_=E.rj.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{getRoles:e.query({query:function(){return{url:(0,E.DS)(k)}},providesTags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[].concat((0,h.Z)(e.map((function(e){var t=e.key;return{type:E.pJ.CITIES,id:t}}))),[{type:E.pJ.CITIES,id:"LIST"}])}}),addRole:e.mutation({query:function(e){return{url:k,method:"POST",body:e}},invalidatesTags:[{type:E.pJ.CITIES,id:"LIST"}]}),getRole:e.query({query:function(e){return"".concat(k).concat(e)},providesTags:function(e,t,n){return[{type:E.pJ.CITIES,id:n}]}}),updateRole:e.mutation({query:function(e){var t=e.key,n=L(e,["key"]);return{url:"".concat(k).concat(t),method:"PUT",body:n}},invalidatesTags:function(e){return[{type:E.pJ.CITIES,id:null===e||void 0===e?void 0:e.id}]}}),deleteRole:e.mutation({query:function(e){return{url:"".concat(k).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:E.pJ.CITIES,id:null===e||void 0===e?void 0:e.id}]}}),getPermissions:e.query({query:function(){return{url:(0,E.DS)("/permission/")}},providesTags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[].concat((0,h.Z)(e.map((function(e){var t=e.key;return{type:E.pJ.CITIES,id:t}}))),[{type:E.pJ.CITIES,id:"LIST"}])}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),N=_.useAddRoleMutation,R=_.useDeleteRoleMutation,q=(_.useGetRoleQuery,_.useGetRolesQuery),C=_.useUpdateRoleMutation,U=(_.useGetErrorProneQuery,_.useGetPermissionsQuery),j=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function l(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}c((r=r.apply(e,t||[])).next())}))},Z=function(e){var t=(0,l.pm)(),n=t.showSuccess,r=t.showError,o=(0,a.useState)(!1),d=(0,p.Z)(o,2),h=d[0],b=d[1],S=(0,i.s0)(),x=(0,i.UO)().id,I=parseInt(x||""),T=isNaN(I)||I<=0,L=(0,E.ft)(),k=q(),_=k.data,N=(k.isLoading,P(I,{skip:T})),R=N.data,C=N.isLoading,U=(0,a.useState)(null),Z=(0,p.Z)(U,2),A=Z[0],W=Z[1],J=(0,E.sq)(),F=(J.data,J.isFetching,w()),G=(0,p.Z)(F,2),V=G[0],z=G[1].isLoading,D=O(),Q=(0,p.Z)(D,2),M=Q[0],H=Q[1].isLoading;(0,a.useEffect)((function(){var e,t,n;R&&W(Object.assign(Object.assign({},R),{role:(null===(e=null===R||void 0===R?void 0:R.role[0])||void 0===e?void 0:e.id)||"",company:(null===(t=null===R||void 0===R?void 0:R.company)||void 0===t?void 0:t.company_id)||"",client_id:(null===(n=null===R||void 0===R?void 0:R.company)||void 0===n?void 0:n.client_id)||""}))}),[R]);return a.createElement(a.Fragment,null,a.createElement(l.Rm,{baseRoute:"/".concat(c.o,"/").concat(u),description:s,id:I,data:A,isUpdating:z||H||h,isLoading:C,onSubmit:function(e){return j(void 0,void 0,void 0,(0,m.Z)().mark((function t(){var o,a;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!T){t.next=7;break}return t.next=4,V(Object.assign(Object.assign({},L),e)).unwrap();case 4:a=t.sent,t.next=10;break;case 7:return t.next=9,M(Object.assign(Object.assign({},L),e)).unwrap();case 9:a=t.sent;case 10:n("Success",a.detail),b(!0),setTimeout((function(){S("/".concat(c.o,"/").concat(u))}),E.P7),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),r("An error occurred",(null===(o=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===o?void 0:o.detail)||"We couldn't save your post, try again!");case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))},renderForm:function(e,t,n,r){return a.createElement("div",{className:"pl-8"},a.createElement(l.Wi,{label:"User Name",name:"user_name",control:e,errors:n,required:!0,leftSpan:2,rightSpan:5,formItem:{component:f.o,componentProps:{maxLength:100}}}),a.createElement(l.Wi,{label:"First Name",name:"first_name",control:e,errors:n,leftSpan:2,rightSpan:4,required:!0,formItem:{component:f.o,componentProps:{maxLength:100}}}),a.createElement(l.Wi,{label:"Last Name",name:"last_name",control:e,errors:n,leftSpan:2,rightSpan:4,formItem:{component:f.o,componentProps:{maxLength:100}}}),a.createElement(l.Wi,{label:"Phone Number",name:"phone_number",required:!0,control:e,errors:n,leftSpan:2,rightSpan:4,formItem:{component:f.o,componentProps:{maxLength:100}}}),a.createElement(l.Wi,{label:"Email",name:"email",required:!0,control:e,errors:n,leftSpan:2,rightSpan:6,formItem:{component:f.o,componentProps:{maxLength:100}}}),a.createElement("div",{className:"field"},a.createElement("label",{style:{margin:"auto",paddingLeft:0},htmlFor:"is_active",className:"col-2"},"Is Active?"),a.createElement(v.Qr,{defaultValue:!1,name:"is_active",control:e,render:function(e){var t=e.field;e.fieldState;return a.createElement(y.X,Object.assign({checked:t.value,trueValue:!0,falseValue:!1,id:t.name},t))}})),a.createElement(l.Wi,{label:"Role",name:"role",control:e,errors:n,required:!0,leftSpan:2,rightSpan:4,useExplicit:!0,formItem:{component:g.L,componentProps:{optionGroupTemplate:a.createElement("div",{style:{cursor:"pointer",textAlign:"center",backgroundColor:"#e6e1e1",color:"black",lineHeight:2.5},onClick:function(){return S("/users/roles",{state:{url:T?"/users/users/new":"/users/users/".concat(null===A||void 0===A?void 0:A.id,"/edit"),data:r()}})}},"-- Create And Edit --"),optionLabel:"role",optionValue:"id",optionGroupLabel:"label",optionGroupChildren:"items",options:[{label:"Add",items:_||[]}]}}}))}}))},A=function(e){var t=(0,a.useState)(1),n=(0,p.Z)(t,2),r=n[0],o=n[1],i=(0,a.useState)(E.IV),d=(0,p.Z)(i,2),m=d[0],v=d[1],f=T({page:r,size:m},{refetchOnMountOrArgChange:!0}),g=f.data,y=f.isFetching,h=I(),b=(0,p.Z)(h,2),S=b[0],x=b[1].isLoading;return a.createElement(l.PS,{pagination:{pageSize:m,loading:y,currentPage:r,total:null===g||void 0===g?void 0:g.count,onChange:function(e,t){o(e),v(t)}},baseRoute:"/".concat(c.o,"/").concat(u),description:s,isLoading:y||x,data:null===g||void 0===g?void 0:g.results,deleteAction:function(e){return S(e).unwrap()},newTable:!0,showHeader:!0,navKey:"id",delKey:"id"},a.createElement(l._P,{field:"id",header:"User Code",filteringType:"number"}),a.createElement(l._P,{field:"user_name",header:"User Name",filteringType:"text"}),a.createElement(l._P,{field:"first_name",header:"First Name",filteringType:"text"}),a.createElement(l._P,{field:"phone_number",header:"Phone Number",filteringType:"text"}),a.createElement(l._P,{field:"email",header:"Email",filteringType:"text"}))},W=a.createElement(i.AW,{path:u},a.createElement(i.AW,{path:"new",element:a.createElement(Z,null)}),a.createElement(i.AW,{path:":id/edit",element:a.createElement(Z,null)}),a.createElement(i.AW,{index:!0,element:a.createElement(A,null)})),J=n(4401),F=n(6272),G=n(8356),V=n(6770),z=n(8103),D=n(4576),Q=n(1387),M=n(4756),H=n(7624),K=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function l(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}c((r=r.apply(e,t||[])).next())}))},B=function(){var e=(0,i.s0)(),t=(0,i.TH)().state,n=(0,E.ft)(),r=(0,v.cI)({}),o=r.control,c=r.formState,u=c.errors,s=(c.isDirty,r.register,r.reset,r.handleSubmit),d=r.setValue,g=q(),y=g.data,h=g.isLoading,b=g.refetch,S=U(),x=S.data,w=(S.isLoading,(0,a.useState)([])),I=(0,p.Z)(w,2),P=I[0],T=I[1],O=(0,a.useState)(!0),L=(0,p.Z)(O,2),k=L[0],_=L[1],j=(0,a.useState)(null),Z=(0,p.Z)(j,2),A=Z[0],W=Z[1],B=(0,a.useRef)(null),X=(0,a.useState)(!1),Y=(0,p.Z)(X,2),$=(Y[0],Y[1],N()),ee=(0,p.Z)($,2),te=ee[0],ne=ee[1].isLoading,re=C(),oe=(0,p.Z)(re,2),ae=oe[0],ie=oe[1].isLoading,le=R(),ce=(0,p.Z)(le,2),ue=ce[0],se=(ce[1].isLoading,function(e){return ue(e).unwrap()}),de=function(e,t){var n;null===(n=null===B||void 0===B?void 0:B.current)||void 0===n||n.show({severity:"success",summary:e,detail:t,life:3e3})},me=function(e,t){var n;null===(n=null===B||void 0===B?void 0:B.current)||void 0===n||n.show({severity:"error",summary:e,detail:t,life:3e3})};return h?a.createElement("div",{className:"custom-skeleton p-4"},a.createElement("div",null,a.createElement(F.O,{height:"50px",width:"30%",className:"mb-2"}),a.createElement(F.O,{height:"50px",width:"50%",className:"mb-2"}))):a.createElement(a.Fragment,null,a.createElement(Q.F,{ref:B}),a.createElement(l.Gn,{className:"pl-8",style:{height:"50%",width:"90%"},header:a.createElement("div",{className:"flex"},a.createElement("h3",{className:(0,M.AK)("m-0 my-auto")},"Role")),rowHover:!0,onRowClick:function(e){_(!1),W(e.data),d("role",e.data.role),d("role_description",e.data.role_description),T(null===x||void 0===x?void 0:x.filter((function(t){var n,r;return(null===(r=null===(n=e.data)||void 0===n?void 0:n.access)||void 0===r?void 0:r.filter((function(e){return e.id===t.id})).length)>0})))},value:y,stripedRows:!0},a.createElement(J.s,{headerStyle:H.jc,style:{maxWidth:"80px"},bodyStyle:{textAlign:"center",overflow:"visible"},body:function(e){return function(t){return a.createElement(a.Fragment,null,a.createElement(V.z,{onClick:function(){console.log(t),_(!1),W(t),d("role",t.role),d("role_description",t.role_description),T(null===x||void 0===x?void 0:x.filter((function(e){return[1,2].includes(e.id)})))},icon:"pi pi-eye",className:"p-button-rounded p-button-text"}),a.createElement(V.z,{style:{height:"20px",width:"20px",borderRadius:50},onClick:function(){return e(t.id)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"}))}}((function(e){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(se){t.next=2;break}return t.abrupt("return");case 2:(0,D.V)({message:"Are you sure you want to delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){var n,r;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,se(e);case 3:r=t.sent,de("Success",r),_(!0),W(null),d("role",""),d("role_description",""),T([]),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),me("Failed",null===(n=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===n?void 0:n.detail);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))},reject:function(){}});case 3:case"end":return t.stop()}}),t)})))}))}),a.createElement(J.s,{headerStyle:H.iR,style:{maxWidth:"200px"},field:"role",header:"Role Name",sortable:!0,filter:!0}),a.createElement(J.s,{headerStyle:H.iR,field:"access_pages",header:"Accessible Pages",body:function(e){return null===e||void 0===e?void 0:e.access.map((function(e){return e.name})).join(",")}})),a.createElement(G.i,null),a.createElement("form",{onSubmit:s((function(e){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){var r,o;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,o=Object.assign(Object.assign({},e),{access:null===P||void 0===P?void 0:P.map((function(e){return e.id})),is_role_active:!0}),console.log(o),!k){t.next=9;break}return t.next=6,te(Object.assign(Object.assign({},o),n)).unwrap();case 6:r=t.sent,t.next=12;break;case 9:return t.next=11,ae(Object.assign(Object.assign({key:null===A||void 0===A?void 0:A.id},o),n)).unwrap();case 11:r=t.sent;case 12:_(!0),W(null),d("role",""),d("role_description",""),T([]),de("Success",r.detail),b(),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(0),me("An error occurred","We couldn't save your request, try again!");case 24:case"end":return t.stop()}}),t,null,[[0,21]])})))}))},a.createElement("div",{className:"flex"},a.createElement("div",{className:"col-1"}),a.createElement("div",{className:"col-7"},function(e,t,n){var r,o;return a.createElement("div",{className:"pl-8"},a.createElement(l.Wi,{label:"Role Name",name:"role",control:e,errors:n,required:!0,leftSpan:4,rightSpan:5,formItem:{component:f.o,componentProps:{maxLength:50,disabled:ne||ie||"superadmin"===(null===(r=null===A||void 0===A?void 0:A.role)||void 0===r?void 0:r.toLowerCase())}}}),a.createElement(l.Wi,{label:"Description",name:"role_description",control:e,errors:n,required:!0,leftSpan:4,rightSpan:5,formItem:{component:f.o,componentProps:{maxLength:50,disabled:ne||ie}}}),a.createElement(l.Wi,{label:"Accessible Pages",name:"access",control:e,errors:n,leftSpan:4,rightSpan:5,formItem:{component:z.N,componentProps:{value:P,optionLabel:"permission",onChange:function(e){return T(e.value)},options:x,display:"chip",disabled:ne||ie||"superadmin"===(null===(o=null===A||void 0===A?void 0:A.role)||void 0===o?void 0:o.toLowerCase()),placeholder:"Select Pages",className:"w-full md:w-20rem"}}}))}(o,0,u)),a.createElement("div",{className:"my-auto"},a.createElement(V.z,{loading:ne||ie,label:"Save",id:"submit",type:"submit",style:{paddingRight:20},className:"p-button-warning mr-3"}),a.createElement(V.z,{loading:ne||ie,label:"Clear",style:{paddingRight:20},className:"p-button-warning mr-3",onClick:function(e){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),_(!0),W(null),d("role",""),d("role_description",""),T([]);case 6:case"end":return t.stop()}}),t)})))}}),a.createElement(V.z,{loading:ne||ie,label:"Back",onClick:function(){return e((null===t||void 0===t?void 0:t.url)||"/users/users",{state:t.data})}})))))},X=a.createElement(i.AW,{path:"roles"},a.createElement(i.AW,{index:!0,element:a.createElement(B,null)})),Y=function(){var e,t,n,r,o,c=(0,E.aC)();null===(n=null===(t=null===(e=c.user)||void 0===e?void 0:e.role[0])||void 0===t?void 0:t.access)||void 0===n||n.map((function(e){return e.name}));return a.createElement(i.Z5,null,(null===(o=null===(r=c.user)||void 0===r?void 0:r.privilege)||void 0===o?void 0:o.toLowerCase().includes("superadmin"))?a.createElement(i.AW,{path:"/",element:a.createElement(l.SV,{navItems:d})},a.createElement(i.AW,{index:!0,element:a.createElement(i.Fg,{to:u,replace:!0})}),W,X,a.createElement(i.AW,{path:":page/comming-soon",element:a.createElement(l.hg,null)}),a.createElement(i.AW,{path:"*",element:a.createElement(l.EN,{relative:!0})})):a.createElement(i.AW,{path:"/",element:a.createElement(l.SV,{navItems:d})},a.createElement(i.AW,{path:"*",element:a.createElement(l.Sd,{relative:!0})})))}}}]);
//# sourceMappingURL=526.a78ff26e.chunk.js.map