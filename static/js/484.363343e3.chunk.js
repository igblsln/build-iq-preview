"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[484],{8484:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var r,a,o=n(969),i=n(734),c=n(2035),l=n(3383),u=[{items:[{label:"Contract",icon:"pi ml-3",template:(r="contract",(0,c.E7)("/".concat(l.o,"/").concat(r)+(a?"/comming-soon":"")))}]}],s=n(2723),d=n(6234),m=n(3665),p=n(7765),f=n(6770),v=n(8301),g=n(8224),y=n(3127),h=n(4576),C=n(1495),E=n(8079),b="/contract/contractor/",S=C.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listContract:e.query({query:function(e){var t=e.page,n=e.size;return{url:(0,C.DS)(b,"?page=".concat(t||1,"&page_size=").concat(n||C.IV))}},providesTags:function(e){return e?[].concat((0,E.Z)(null===e||void 0===e?void 0:e.results.map((function(e){var t=e.key;return{type:C.pJ.CONTRACT,key:t}}))),[{type:C.pJ.CONTRACT,id:"LIST"}]):[{type:C.pJ.CONTRACT,id:"LIST"}]}}),addContract:e.mutation({query:function(e){return{url:b,method:"POST",body:e}},invalidatesTags:[{type:C.pJ.CONTRACT,id:"LIST"}]}),getContract:e.query({query:function(e){return"".concat(b).concat(e)},providesTags:function(e,t,n){return[{type:C.pJ.CONTRACT,id:n}]}}),updateContract:e.mutation({query:function(e){var t=e;return{url:"".concat(b),method:"POST",body:t}},invalidatesTags:[{type:C.pJ.CONTRACT,id:"LIST"}]}),deleteContract:e.mutation({query:function(e){return{url:"".concat(b).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:C.pJ.CONTRACT,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),T=S.useAddContractMutation,_=S.useDeleteContractMutation,k=S.useGetContractQuery,w=S.useListContractQuery,x=S.useUpdateContractMutation,L=(S.useGetErrorProneQuery,S.endpoints.getContract,"contract"),I=(0,o.forwardRef)((function(e,t){var n=e.data,r=e.isLoading,a=e.disableTable,i=void 0!==a&&a,u=e.onChange,s=void 0===u?function(){}:u,m=(0,o.useState)([]),p=(0,d.Z)(m,2),v=p[0],y=p[1],h=(0,o.useRef)(v),E=(0,o.useRef)([]),b=(0,C.K)({}).data;(0,o.useImperativeHandle)(t,(function(){return{getItems:function(){return v}}})),(0,o.useEffect)((function(){y(n),h.current=n}),[n]),(0,o.useEffect)((function(){E.current=b||[]}),[b]);return o.createElement(c.PS,{baseRoute:"/".concat(l.o,"/").concat(L),description:"Contract",isLoading:r,data:v,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,hideActionColumn:i,actionBodyTemplate:function(e){return o.createElement(f.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=h.current.filter((function(t){return t!==e}));h.current=t,y(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!0,disableAdd:i||!function(e){if(0===e.length)return!0;var t=e[e.length-1];return(null===t||void 0===t?void 0:t.item_descr)&&(null===t||void 0===t?void 0:t.itemuom_key)}(v),newRowDefaults:{netamt:0,qty:0,unitprice:0},OnRowsChanged:function(e){var t=e.map((function(e){return Object.assign(Object.assign({},e),{netamt:e.qty*e.unitprice})}));y(t),h.current=t,s(!0)},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},o.createElement(c._P,{field:"service_descr",header:"Service Description",type:"text",editorType:!i&&"text"}),o.createElement(c._P,{field:"service_qty",header:"Service Quantity",type:"text",editorType:!i&&"text"}),o.createElement(c._P,{field:"itemuom_key",header:"UOM*",displayValueGetter:function(e,t){var n,r;if(!Array.isArray(e)){var a=null===(n=E.current)||void 0===n?void 0:n.filter((function(n){return n.key===e[t]}));return a.length?a[0].descr:null===(r=null===e||void 0===e?void 0:e.items_uoms)||void 0===r?void 0:r.descr}},editorType:!i&&function(e){var t=e.row,n=e.column,r=e.onRowChange;e.onClose;return o.createElement(g.L,{autoFocus:!0,className:"p-inputtext-sm",value:t[n.key],optionLabel:"descr",optionValue:"key",options:E.current,filter:!0,filterBy:"descr",onChange:function(e){var a=Object.assign({},t);a[n.key]=e.value,r(a,!0)},tabIndex:-1})}}),o.createElement(c._P,{field:"unitprice",header:"Rate Per Unit",type:"number",editorType:!i&&"number"}),o.createElement(c._P,{field:"netamt",header:"Service Cost",type:"currency",defaultValue:0,summaryFormatter:function(e){var t,n=e.row;return t=null===n||void 0===n?void 0:n.netamt,o.createElement(c.JK,{value:t||0})}}))})),P=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(t){o(t)}}function c(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}l((r=r.apply(e,t||[])).next())}))},A=function(e,t){return e?t?"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()):new Date(e):e},N=function(e){(0,m.Z)(e);var t=(0,c.pm)(),n=t.showSuccess,r=t.showError,a=(0,o.useState)(!1),u=(0,d.Z)(a,2),E=u[0],b=u[1],S=(0,o.useState)({}),_=(0,d.Z)(S,2),w=_[0],N=_[1],O=(0,o.useState)(!1),R=(0,d.Z)(O,2),Z=R[0],j=R[1],W=(0,o.useState)(!1),q=(0,d.Z)(W,2),V=q[0],D=(q[1],(0,o.useState)("")),U=(0,d.Z)(D,2),B=(U[0],U[1]),F=(0,o.useState)("S"),M=(0,d.Z)(F,2),J=M[0],z=M[1],H=(0,o.useState)("SAVE"),G=(0,d.Z)(H,2),Q=G[0],K=G[1],Y=(0,i.UO)().id,X=parseInt(Y||""),$=isNaN(X)||X<=0,ee=(0,o.useRef)(),te=(0,o.useRef)(),ne=(0,o.useRef)(),re=(0,C.ft)(),ae=(0,o.useState)(null),oe=(0,d.Z)(ae,2),ie=(oe[0],oe[1]),ce=k(X,{skip:$}),le=ce.data,ue=ce.isLoading,se=ce.refetch,de=(0,C.Gt)("VCN",{skip:!$}),me=de.data,pe=de.isLoading,fe=(0,i.s0)(),ve=(0,C.JB)(),ge=ve.data,ye=ve.isLoading,he=(0,C.rC)(),Ce=he.data,Ee=he.isLoading,be=x(),Se=(0,d.Z)(be,2),Te=Se[0],_e=Se[1].isLoading,ke=T(),we=(0,d.Z)(ke,2),xe=we[0],Le=we[1].isLoading;(0,o.useEffect)((function(){N(le||Object.assign(Object.assign({},re),{contractdate:A(new Date,!0),docid:"VCN",contractno:null===me||void 0===me?void 0:me.next_doc_id,loctyp:"PR"}))}),[le,me]),(0,o.useEffect)((function(){var e,t;if(le&&Ce){var n=null===Ce||void 0===Ce?void 0:Ce.filter((function(e){return e.key===le.vend_key}));n&&B(null===(t=null===(e=n[0])||void 0===e?void 0:e.type)||void 0===t?void 0:t.id)}le&&ie(le.proj_key)}),[le,Ce]);var Ie=function(){return["U","R","C"].includes(null===le||void 0===le?void 0:le.docstatus)},Pe=function(e,t){return P(void 0,void 0,void 0,(0,s.Z)().mark((function n(){var r;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,z(e);case 2:return n.next=4,K(t);case 4:null===(r=document.getElementById("submit"))||void 0===r||r.click();case 5:case"end":return n.stop()}}),n)})))};return o.createElement(o.Fragment,null,o.createElement(c.Rm,{ref:ne,baseRoute:"/".concat(l.o,"/").concat(L),description:"Contract",id:X,data:w,disableSaveBtn:Ie(),isItemsTableChanged:Z||V,moreSubmitItems:o.createElement(o.Fragment,null,o.createElement(f.z,{label:"Submit",style:{margin:"0 20px"},disabled:"S"!==(null===le||void 0===le?void 0:le.docstatus),onClick:function(e){var t;e.preventDefault(),(null===(t=ne.current)||void 0===t?void 0:t.getIsDirty())||Z||V?(0,h.V)({message:"Do you want to save the changes before submit?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){return Pe("U","SUBMIT_WITH_SAVE")},reject:function(){return Pe("U","SUBMIT_WITHOUT_SAVE")}}):Pe("U","SUBMIT_WITH_SAVE")}}),o.createElement(f.z,{label:"Cancel",disabled:$||["R","C"].includes(null===le||void 0===le?void 0:le.docstatus),className:"p-button-plain",onClick:function(e){return K("CANCEL"),z("C"),!0}})),isUpdating:Le||_e||E,isLoading:ue,onSubmit:function(e){return P(void 0,void 0,void 0,(0,s.Z)().mark((function t(){var a,o,i,c,u,d,m;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=null===(a=ee.current)||void 0===a?void 0:a.getItems(),u=null===(o=te.current)||void 0===o?void 0:o.getItems(),d=Object.assign(Object.assign({},e),{contractdate:(0,C.p6)(e.contractdate,"yyyy-MM-dd"),docstatus:J,action:Q,vend_contract_tasks:c,vend_contract_stages:u}),t.prev=3,!$){t.next=10;break}return t.next=7,xe(Object.assign(Object.assign({},d),re)).unwrap();case 7:m=t.sent,t.next=13;break;case 10:return t.next=12,Te(Object.assign(Object.assign({},d),re)).unwrap();case 12:m=t.sent;case 13:se(),n("Success",m.detail),b(!0),setTimeout((function(){fe("/".concat(l.o,"/").concat(L))}),C.P7),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(3),r("An error occurred",(null===(i=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===i?void 0:i.detail)||"We couldn't save your post, try again!");case 22:case"end":return t.stop()}}),t,null,[[3,19]])})))},renderForm:function(e,t,n){var r;return o.createElement("div",{className:"pl-4 pt-4 pb-3 grid p-fluid h-full"},o.createElement(c.Wi,{label:"Contract ID",name:"contractno",isLoading:pe,className:"col-10 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:8,formItem:{component:v.R,componentProps:{useGrouping:!1,disabled:!0}}}),o.createElement(c.Wi,{label:"Contractor Category",name:"vend_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:Ee,required:"Select a Contractor",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){var t,n,r=null===Ce||void 0===Ce?void 0:Ce.filter((function(t){return t.key===e.value}));r&&B(null===(n=null===(t=r[0])||void 0===t?void 0:t.type)||void 0===n?void 0:n.id)},formItem:{component:g.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:Ce}}}),o.createElement(c.Wi,{label:"Contractor Name",name:"vend_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:Ee,required:"Select a Contractor",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){var t,n,r=null===Ce||void 0===Ce?void 0:Ce.filter((function(t){return t.key===e.value}));r&&B(null===(n=null===(t=r[0])||void 0===t?void 0:t.type)||void 0===n?void 0:n.id)},formItem:{component:g.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:Ce}}}),o.createElement(c.Wi,{label:"Contract Date",name:"contractdate",className:"col-10 md:col-6",useExplicit:!0,control:e,errors:n,convertValue:A,required:"Select a Date",leftSpan:4,rightSpan:8,formItem:{component:y.f,componentProps:{showIcon:!0,dateFormat:"yy-mm-dd"}}}),o.createElement(c.Wi,{label:"Project",name:"proj_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:ye,required:"Select a Project",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){ie(e.value)},formItem:{component:g.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:ge}}}),o.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},o.createElement(I,{data:(null===le||void 0===le?void 0:le.vend_contract_tasks)||(null===(r=ee.current)||void 0===r?void 0:r.getItems())||[],isLoading:ue,ref:ee,disableTable:Ie(),onChange:function(e){return!Z&&j(e)}})),o.createElement(c.Wi,{label:"Total Contract Amount",name:"contractamt",leftSpan:4,rightSpan:8,className:"col-10 md:col-6",control:e,errors:n,formItem:{component:p.o,componentProps:{disabled:!0,maxLength:25}}}),o.createElement(c.Wi,{label:"Description",name:"notes",className:"col-12 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:8,formItem:{component:p.o,componentProps:{maxLength:255}}}))}}))},O=function(e){var t=(0,o.useState)(1),n=(0,d.Z)(t,2),r=n[0],a=n[1],i=(0,o.useState)(C.IV),u=(0,d.Z)(i,2),s=u[0],m=u[1],p=w({page:r,size:s},{refetchOnMountOrArgChange:!0}),f=p.data,v=p.isFetching,g=_(),y=(0,d.Z)(g,2),h=y[0],E=y[1].isLoading;return o.createElement(c.PS,{pagination:{pageSize:s,loading:v,currentPage:r,total:null===f||void 0===f?void 0:f.count,onChange:function(e,t){a(e),m(t)}},baseRoute:"/".concat(l.o,"/").concat(L),description:"Contracts",isLoading:v||E,data:null===f||void 0===f?void 0:f.results,deleteAction:function(e){return h(e).unwrap()},newTable:!0,showHeader:!0},o.createElement(c._P,{field:"contractno",header:"Contract No",filteringType:"number"}),o.createElement(c._P,{field:"contractdate",header:"Contract Date",filteringType:"date"}),o.createElement(c._P,{field:"vendor.name",header:"Contractor",filteringType:"text"}),o.createElement(c._P,{field:"project.name",header:"Project",filteringType:"text"}),o.createElement(c._P,{field:"status.descr",header:"Status",filteringType:"text"}))},R=o.createElement(i.AW,{path:"contract"},o.createElement(i.AW,{path:"new",element:o.createElement(N,null)}),o.createElement(i.AW,{path:":id/edit",element:o.createElement(N,null)}),o.createElement(i.AW,{index:!0,element:o.createElement(O,null)})),Z=function(){var e,t,n;null===(n=null===(t=null===(e=(0,C.aC)().user)||void 0===e?void 0:e.role[0])||void 0===t?void 0:t.access)||void 0===n||n.map((function(e){return e.name}));return o.createElement(i.Z5,null,o.createElement(i.AW,{path:"/",element:o.createElement(c.SV,{navItems:u})},o.createElement(i.AW,{index:!0,element:o.createElement(i.Fg,{to:L,replace:!0})}),R,o.createElement(i.AW,{path:":page/comming-soon",element:o.createElement(c.hg,null)}),o.createElement(i.AW,{path:"*",element:o.createElement(c.EN,{relative:!0})})))}}}]);
//# sourceMappingURL=484.363343e3.chunk.js.map