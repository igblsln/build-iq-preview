"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[971],{5971:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var a,r,o=n(969),i=n(734),c=n(2035),l=n(3383),u=[{items:[{label:"Contract",icon:"pi ml-3",template:(a="contract",(0,c.E7)("/".concat(l.o,"/").concat(a)+(r?"/comming-soon":"")))}]}],d=n(2723),s=n(6234),m=n(3665),p=n(7765),f=n(8301),v=n(8224),g=n(3127),y=n(1495),h=n(8079),C="/contract/contractor/",E=y.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listContract:e.query({query:function(e){var t=e.page,n=e.size;return{url:(0,y.DS)(C,"?page=".concat(t||1,"&page_size=").concat(n||y.IV))}},providesTags:function(e){return e?[].concat((0,h.Z)(null===e||void 0===e?void 0:e.results.map((function(e){var t=e.key;return{type:y.pJ.CONTRACT,key:t}}))),[{type:y.pJ.CONTRACT,id:"LIST"}]):[{type:y.pJ.CONTRACT,id:"LIST"}]}}),addContract:e.mutation({query:function(e){return{url:C,method:"POST",body:e}},invalidatesTags:[{type:y.pJ.CONTRACT,id:"LIST"}]}),getContract:e.query({query:function(e){return"".concat(C).concat(e)},providesTags:function(e,t,n){return[{type:y.pJ.CONTRACT,id:n}]}}),updateContract:e.mutation({query:function(e){var t=e;return{url:"".concat(C),method:"POST",body:t}},invalidatesTags:[{type:y.pJ.CONTRACT,id:"LIST"}]}),deleteContract:e.mutation({query:function(e){return{url:"".concat(C).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:y.pJ.CONTRACT,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),b=E.useAddContractMutation,S=E.useDeleteContractMutation,T=E.useGetContractQuery,w=E.useListContractQuery,x=E.useUpdateContractMutation,_=(E.useGetErrorProneQuery,E.endpoints.getContract,n(6770)),k="contract",L="Contract",P=(0,o.forwardRef)((function(e,t){var n=e.data,a=e.isLoading,r=e.disableTable,i=void 0!==r&&r,u=e.onChange,d=void 0===u?function(){}:u,m=(0,o.useState)([]),p=(0,s.Z)(m,2),f=p[0],g=p[1],h=(0,o.useRef)(f),C=(0,o.useRef)([]),E=(0,y.K)({}).data;(0,o.useImperativeHandle)(t,(function(){return{getItems:function(){return f}}})),(0,o.useEffect)((function(){g(n),h.current=n}),[n]),(0,o.useEffect)((function(){C.current=E||[]}),[E]);return o.createElement(c.PS,{baseRoute:"/".concat(l.o,"/").concat(k),description:L,isLoading:a,data:f,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,hideActionColumn:i,actionBodyTemplate:function(e){return o.createElement(_.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=h.current.filter((function(t){return t!==e}));h.current=t,g(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!0,disableAdd:i||!function(e){if(0===e.length)return!0;var t=e[e.length-1];return(null===t||void 0===t?void 0:t.item_descr)&&(null===t||void 0===t?void 0:t.itemuom_key)}(f),newRowDefaults:{netamt:0,qty:0,unitprice:0},OnRowsChanged:function(e){var t=e.map((function(e){return Object.assign(Object.assign({},e),{netamt:e.qty*e.unitprice})}));g(t),h.current=t,d(!0)},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},o.createElement(c._P,{field:"service_descr",header:"Service Description",type:"text",editorType:!i&&"text"}),o.createElement(c._P,{field:"service_qty",header:"Service Quantity",type:"text",editorType:!i&&"text"}),o.createElement(c._P,{field:"itemuom_key",header:"UOM*",displayValueGetter:function(e,t){var n,a;if(!Array.isArray(e)){var r=null===(n=C.current)||void 0===n?void 0:n.filter((function(n){return n.key===e[t]}));return r.length?r[0].descr:null===(a=null===e||void 0===e?void 0:e.items_uoms)||void 0===a?void 0:a.descr}},editorType:!i&&function(e){var t=e.row,n=e.column,a=e.onRowChange;e.onClose;return o.createElement(v.L,{autoFocus:!0,className:"p-inputtext-sm",value:t[n.key],optionLabel:"descr",optionValue:"key",options:C.current,filter:!0,filterBy:"descr",onChange:function(e){var r=Object.assign({},t);r[n.key]=e.value,a(r,!0)},tabIndex:-1})}}),o.createElement(c._P,{field:"unitprice",header:"Rate Per Unit",type:"number",editorType:!i&&"number"}),o.createElement(c._P,{field:"netamt",header:"Service Cost",type:"currency",defaultValue:0,summaryFormatter:function(e){var t,n=e.row;return t=null===n||void 0===n?void 0:n.netamt,o.createElement(c.JK,{value:t||0})}}))})),R=n(6666),A=n(8391),I=(0,o.forwardRef)((function(e,t){var n=e.data,a=e.isLoading,r=e.disableTable,i=void 0!==r&&r,u=e.selectedProject,d=(0,o.useState)([]),m=(0,s.Z)(d,2),p=m[0],f=m[1],v=(0,o.useRef)(p),g=(0,o.useRef)([]),h=(0,y.aM)({id:u},{skip:!u}).data;(0,o.useImperativeHandle)(t,(function(){return{getItems:function(){return p}}})),(0,o.useEffect)((function(){f(n),v.current=n}),[n]),(0,o.useEffect)((function(){g.current=h||[]}),[h]);return o.createElement(o.Fragment,null,o.createElement(c.PS,{baseRoute:"/".concat(l.o,"/").concat(k),description:L,isLoading:a,data:p,newTable:!0,tableLayoutClass:"h-full",hideActionColumn:i,allowFilters:!1,actionBodyTemplate:function(e){return o.createElement(_.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=v.current.filter((function(t){return t!==e}));v.current=t,f(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!0,disableAdd:i||!function(e){if(0===e.length)return!0;var t=e[e.length-1];return(null===t||void 0===t?void 0:t.item_descr)&&(null===t||void 0===t?void 0:t.netamt)}(p),newRowDefaults:{netamt:0},OnRowsChanged:function(e){f(e),v.current=e},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},o.createElement(c._P,{field:"sno",width:"5%",header:"S.No",type:"text"}),o.createElement(c._P,{field:"descr",header:"Service Description",editorType:!i&&"text"}),o.createElement(c._P,{field:"invoiceamt",header:"Invoice Amount",type:"currency",defaultValue:0,editorType:!i&&"currency"}),o.createElement(c._P,{width:"10%",field:"selected",defaultValue:!1,header:"Select",type:"checkbox",editorType:function(e){var t=e.row,n=e.column,a=e.onRowChange,r=e.onClose;return o.createElement(A.X,{style:{width:"100%",display:"flex",margin:"10px auto",justifyContent:"center"},checked:t[n.key],onChange:function(e){a(Object.assign(Object.assign({},t),(0,R.Z)({},n.key,e.checked)),!0),r(!0)},tabIndex:-1})}})),o.createElement(_.z,{label:"Raise",style:{marginLeft:"auto",marginTop:5,display:"flex",width:100},onClick:function(){},className:"p-button-plain"}))})),N=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{l(a.next(e))}catch(t){o(t)}}function c(e){try{l(a.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}l((a=a.apply(e,t||[])).next())}))},O=function(e,t){return e?t?"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()):new Date(e):e},j=function(e){(0,m.Z)(e);var t=(0,c.pm)(),n=t.showSuccess,a=t.showError,r=(0,o.useState)(!1),u=(0,s.Z)(r,2),h=u[0],C=u[1],E=(0,o.useState)({}),S=(0,s.Z)(E,2),w=S[0],_=S[1],L=(0,o.useState)(!1),R=(0,s.Z)(L,2),A=R[0],j=R[1],Z=(0,o.useState)(!1),q=(0,s.Z)(Z,2),W=q[0],D=(q[1],(0,o.useState)("")),V=(0,s.Z)(D,2),F=(V[0],V[1]),B=(0,o.useState)("S"),J=(0,s.Z)(B,2),M=J[0],z=(J[1],(0,o.useState)("SAVE")),U=(0,s.Z)(z,2),G=U[0],H=(U[1],(0,i.UO)().id),Q=parseInt(H||""),K=isNaN(Q)||Q<=0,X=(0,o.useRef)(),Y=(0,o.useRef)(),$=(0,o.useRef)(),ee=(0,y.ft)(),te=(0,o.useState)(null),ne=(0,s.Z)(te,2),ae=ne[0],re=ne[1],oe=T(Q,{skip:K}),ie=oe.data,ce=oe.isLoading,le=oe.refetch,ue=(0,y.Gt)("VCN",{skip:!K}),de=ue.data,se=ue.isLoading,me=(0,i.s0)(),pe=(0,y.JB)(),fe=pe.data,ve=pe.isLoading,ge=(0,y.rC)(),ye=ge.data,he=ge.isLoading,Ce=x(),Ee=(0,s.Z)(Ce,2),be=Ee[0],Se=Ee[1].isLoading,Te=b(),we=(0,s.Z)(Te,2),xe=we[0],_e=we[1].isLoading;(0,o.useEffect)((function(){_(ie||Object.assign(Object.assign({},ee),{contractdate:O(new Date,!0),docid:"VCN",contractno:null===de||void 0===de?void 0:de.next_doc_id,loctyp:"PR"}))}),[ie,de]),(0,o.useEffect)((function(){var e,t;if(ie&&ye){var n=null===ye||void 0===ye?void 0:ye.filter((function(e){return e.key===ie.vend_key}));n&&F(null===(t=null===(e=n[0])||void 0===e?void 0:e.type)||void 0===t?void 0:t.id)}ie&&re(ie.proj_key)}),[ie,ye]);var ke=function(){return["U","R","C"].includes(null===ie||void 0===ie?void 0:ie.docstatus)};return o.createElement(o.Fragment,null,o.createElement(c.Rm,{ref:$,baseRoute:"/".concat(l.o,"/").concat(k),description:"Contract",id:Q,data:w,disableSaveBtn:ke(),isItemsTableChanged:A||W,isUpdating:_e||Se||h,isLoading:ce,onSubmit:function(e){return N(void 0,void 0,void 0,(0,d.Z)().mark((function t(){var r,o,i,c,u,s,m;return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=null===(r=X.current)||void 0===r?void 0:r.getItems(),u=null===(o=Y.current)||void 0===o?void 0:o.getItems(),s=Object.assign(Object.assign({},e),{contractdate:(0,y.p6)(e.contractdate,"yyyy-MM-dd"),docstatus:M,action:G,vend_contract_tasks:c,vend_contract_stages:u}),t.prev=3,!K){t.next=10;break}return t.next=7,xe(Object.assign(Object.assign({},s),ee)).unwrap();case 7:m=t.sent,t.next=13;break;case 10:return t.next=12,be(Object.assign(Object.assign({},s),ee)).unwrap();case 12:m=t.sent;case 13:le(),n("Success",m.detail),C(!0),setTimeout((function(){me("/".concat(l.o,"/").concat(k))}),y.P7),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(3),a("An error occurred",(null===(i=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===i?void 0:i.detail)||"We couldn't save your post, try again!");case 22:case"end":return t.stop()}}),t,null,[[3,19]])})))},renderForm:function(e,t,n){var a,r;return o.createElement("div",{className:"pl-4 pt-4 pb-3 grid p-fluid h-full"},o.createElement(c.Wi,{label:"Contract ID",name:"contractno",isLoading:se,className:"col-10 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:8,formItem:{component:f.R,componentProps:{useGrouping:!1,disabled:!0}}}),o.createElement(c.Wi,{label:"Contractor Category",name:"vend_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:he,required:"Select a Contractor",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){var t,n,a=null===ye||void 0===ye?void 0:ye.filter((function(t){return t.key===e.value}));a&&F(null===(n=null===(t=a[0])||void 0===t?void 0:t.type)||void 0===n?void 0:n.id)},formItem:{component:v.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:ye}}}),o.createElement(c.Wi,{label:"Contractor Name",name:"vend_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:he,required:"Select a Contractor",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){var t,n,a=null===ye||void 0===ye?void 0:ye.filter((function(t){return t.key===e.value}));a&&F(null===(n=null===(t=a[0])||void 0===t?void 0:t.type)||void 0===n?void 0:n.id)},formItem:{component:v.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:ye}}}),o.createElement(c.Wi,{label:"Contract Date",name:"contractdate",className:"col-10 md:col-6",useExplicit:!0,control:e,errors:n,convertValue:O,required:"Select a Date",leftSpan:4,rightSpan:8,formItem:{component:g.f,componentProps:{showIcon:!0,dateFormat:"yy-mm-dd"}}}),o.createElement(c.Wi,{label:"Project",name:"proj_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:ve,required:"Select a Project",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){re(e.value)},formItem:{component:v.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:fe}}}),o.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},o.createElement(P,{data:(null===ie||void 0===ie?void 0:ie.vend_contract_tasks)||(null===(a=X.current)||void 0===a?void 0:a.getItems())||[],isLoading:ce,ref:X,disableTable:ke(),onChange:function(e){return!A&&j(e)}})),o.createElement(c.Wi,{label:"Total Contract Amount",name:"contractamt",leftSpan:4,rightSpan:8,className:"col-10 md:col-6",control:e,errors:n,formItem:{component:p.o,componentProps:{disabled:!0,maxLength:25}}}),o.createElement(c.Wi,{label:"Description",name:"notes",className:"col-12 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:8,formItem:{component:p.o,componentProps:{maxLength:255}}}),o.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},o.createElement(I,{data:(null===ie||void 0===ie?void 0:ie.vend_contract_stages)||(null===(r=Y.current)||void 0===r?void 0:r.getItems())||[],isLoading:ce,ref:Y,selectedProject:ae,disableTable:ke()})))}}))},Z=function(e){var t=(0,o.useState)(1),n=(0,s.Z)(t,2),a=n[0],r=n[1],i=(0,o.useState)(y.IV),u=(0,s.Z)(i,2),d=u[0],m=u[1],p=w({page:a,size:d},{refetchOnMountOrArgChange:!0}),f=p.data,v=p.isFetching,g=S(),h=(0,s.Z)(g,2),C=h[0],E=h[1].isLoading;return o.createElement(c.PS,{pagination:{pageSize:d,loading:v,currentPage:a,total:null===f||void 0===f?void 0:f.count,onChange:function(e,t){r(e),m(t)}},baseRoute:"/".concat(l.o,"/").concat(k),description:"Contracts",isLoading:v||E,data:null===f||void 0===f?void 0:f.results,deleteAction:function(e){return C(e).unwrap()},newTable:!0,showHeader:!0},o.createElement(c._P,{field:"contractno",header:"Contract No",filteringType:"number"}),o.createElement(c._P,{field:"contractdate",header:"Contract Date",filteringType:"date"}),o.createElement(c._P,{field:"vendor.name",header:"Contractor",filteringType:"text"}),o.createElement(c._P,{field:"project.name",header:"Project",filteringType:"text"}),o.createElement(c._P,{field:"status.descr",header:"Status",filteringType:"text"}))},q=o.createElement(i.AW,{path:"contract"},o.createElement(i.AW,{path:"new",element:o.createElement(j,null)}),o.createElement(i.AW,{path:":id/edit",element:o.createElement(j,null)}),o.createElement(i.AW,{index:!0,element:o.createElement(Z,null)})),W=function(){var e,t,n;null===(n=null===(t=null===(e=(0,y.aC)().user)||void 0===e?void 0:e.role[0])||void 0===t?void 0:t.access)||void 0===n||n.map((function(e){return e.name}));return o.createElement(i.Z5,null,o.createElement(i.AW,{path:"/",element:o.createElement(c.SV,{navItems:u})},o.createElement(i.AW,{index:!0,element:o.createElement(i.Fg,{to:k,replace:!0})}),q,o.createElement(i.AW,{path:":page/comming-soon",element:o.createElement(c.hg,null)}),o.createElement(i.AW,{path:"*",element:o.createElement(c.EN,{relative:!0})})))}}}]);
//# sourceMappingURL=971.624655aa.chunk.js.map