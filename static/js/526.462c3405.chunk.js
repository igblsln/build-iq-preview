"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[526],{8526:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var r,o,i=n(969),a=n(734),l=n(2035),u=n(4732),c="users",s="User",d=[{items:[{label:"Users",icon:"pi ml-3",template:(r=c,(0,l.E7)("/".concat(u.o,"/").concat(r)+(o?"/comming-soon":"")))}]}],m=n(2723),p=n(6234),v=n(3953),f=n(7765),g=n(8224),y=n(8391),h=n(9459),E=n(8079),b=n(1495),S=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},w="/user/",x=b.rj.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listUser:e.query({query:function(e){var t=e.page,n=e.size;return{url:"".concat(w,"?page=").concat(t||1,"&page_size=").concat(n||b.IV)}},providesTags:function(e){var t;return e?[].concat((0,E.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.id;return{type:b.pJ.USERS,id:t}}))),[{type:b.pJ.USERS,id:"LIST"}]):[{type:b.pJ.USERS,id:"LIST"}]}}),addUser:e.mutation({query:function(e){return{url:w,method:"POST",body:e}},invalidatesTags:[{type:b.pJ.USERS,id:"LIST"}]}),getUser:e.query({query:function(e){return"".concat(w).concat(e)},providesTags:function(e,t,n){return[{type:b.pJ.USERS,id:n}]}}),updateUser:e.mutation({query:function(e){var t=e.id,n=S(e,["id"]);return{url:"".concat(w).concat(t),method:"PUT",body:n}},invalidatesTags:function(e){return[{type:b.pJ.USERS,id:null===e||void 0===e?void 0:e.id}]}}),deleteUser:e.mutation({query:function(e){return{url:"".concat(w).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:b.pJ.USERS,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),L=x.useAddUserMutation,T=x.useDeleteUserMutation,I=x.useGetUserQuery,P=x.useListUserQuery,C=x.useUpdateUserMutation,O=(x.useGetErrorProneQuery,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}),k="/role/",q=b.rj.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{getRoles:e.query({query:function(){return{url:(0,b.DS)(k)}},providesTags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[].concat((0,E.Z)(e.map((function(e){var t=e.key;return{type:b.pJ.CITIES,id:t}}))),[{type:b.pJ.CITIES,id:"LIST"}])}}),addRole:e.mutation({query:function(e){return{url:k,method:"POST",body:e}},invalidatesTags:[{type:b.pJ.CITIES,id:"LIST"}]}),getRole:e.query({query:function(e){return"".concat(k).concat(e)},providesTags:function(e,t,n){return[{type:b.pJ.CITIES,id:n}]}}),updateRole:e.mutation({query:function(e){var t=e.key,n=O(e,["key"]);return{url:"".concat(k).concat(t),method:"PUT",body:n}},invalidatesTags:function(e){return[{type:b.pJ.CITIES,id:null===e||void 0===e?void 0:e.id}]}}),deleteRole:e.mutation({query:function(e){return{url:"".concat(k).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:b.pJ.CITIES,id:null===e||void 0===e?void 0:e.id}]}}),getPermissions:e.query({query:function(){return{url:(0,b.DS)("/permission/")}},providesTags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[].concat((0,E.Z)(e.map((function(e){var t=e.key;return{type:b.pJ.CITIES,id:t}}))),[{type:b.pJ.CITIES,id:"LIST"}])}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),N=q.useAddRoleMutation,R=q.useDeleteRoleMutation,_=(q.useGetRoleQuery,q.useGetRolesQuery),j=q.useUpdateRoleMutation,A=(q.useGetErrorProneQuery,q.useGetPermissionsQuery),U=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(t){i(t)}}function l(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}u((r=r.apply(e,t||[])).next())}))},Z=function(e){var t=(0,b.aC)(),n=(0,l.pm)(),r=n.showSuccess,o=n.showError,d=(0,i.useState)(!1),E=(0,p.Z)(d,2),S=E[0],w=E[1],x=(0,a.s0)(),T=(0,a.UO)().id,P=parseInt(T||""),O=isNaN(P)||P<=0,k=(0,b.ft)(),q=_(),N=q.data,R=(q.isLoading,I(P,{skip:O})),j=R.data,A=R.isLoading,Z=(0,i.useState)(null),W=(0,p.Z)(Z,2),J=W[0],F=W[1],V=(0,b.sq)(),G=V.data,D=V.isFetching,z=L(),M=(0,p.Z)(z,2),Q=M[0],H=M[1].isLoading,B=C(),K=(0,p.Z)(B,2),X=K[0],Y=K[1].isLoading;(0,i.useEffect)((function(){var e,t,n;j&&F(Object.assign(Object.assign({},j),{role:(null===(e=null===j||void 0===j?void 0:j.role[0])||void 0===e?void 0:e.id)||"",company:(null===(t=null===j||void 0===j?void 0:j.company)||void 0===t?void 0:t.company_id)||"",client_id:(null===(n=null===j||void 0===j?void 0:j.company)||void 0===n?void 0:n.client_id)||""}))}),[j]);var $=function(){var e,n,r,o,i;return"superadmin"===(null===(n=null===(e=null===j||void 0===j?void 0:j.role[0])||void 0===e?void 0:e.name)||void 0===n?void 0:n.toLowerCase())?(null===(i=null===(o=null===(r=t.user)||void 0===r?void 0:r.role[0])||void 0===o?void 0:o.name)||void 0===i?void 0:i.toLowerCase().includes("superadmin"))?"auto":"none":"auto"};return i.createElement(i.Fragment,null,i.createElement(l.Rm,{baseRoute:"/".concat(u.o,"/").concat(c),description:s,id:P,data:J,isUpdating:H||Y||S,isLoading:A,onSubmit:function(e){return U(void 0,void 0,void 0,(0,m.Z)().mark((function t(){var n,i;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!O){t.next=7;break}return t.next=4,Q(Object.assign(Object.assign({},k),e)).unwrap();case 4:i=t.sent,t.next=10;break;case 7:return t.next=9,X(Object.assign(Object.assign({},k),e)).unwrap();case 9:i=t.sent;case 10:r("Success",i.detail),w(!0),setTimeout((function(){x("/".concat(u.o,"/").concat(c))}),b.P7),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),o("An error occurred",(null===(n=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===n?void 0:n.detail)||"We couldn't save your post, try again!");case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))},renderForm:function(e,n,r,o){var a,u,c;return i.createElement("div",{style:{pointerEvents:$()},className:"pl-8"},i.createElement(l.Wi,{label:"User Name",name:"user_name",control:e,errors:r,required:!0,leftSpan:2,rightSpan:5,formItem:{component:f.o,componentProps:{maxLength:100}}}),i.createElement(l.Wi,{label:"First Name",name:"first_name",control:e,errors:r,leftSpan:2,rightSpan:4,required:!0,formItem:{component:f.o,componentProps:{maxLength:100}}}),i.createElement(l.Wi,{label:"Last Name",name:"last_name",control:e,errors:r,leftSpan:2,rightSpan:4,formItem:{component:f.o,componentProps:{maxLength:100}}}),i.createElement(l.Wi,{label:"Phone Number",name:"phone_number",required:!0,control:e,errors:r,leftSpan:2,rightSpan:4,formItem:{component:f.o,componentProps:{maxLength:100}}}),i.createElement(l.Wi,{label:"Email",name:"email",required:!0,control:e,errors:r,leftSpan:2,rightSpan:6,formItem:{component:f.o,componentProps:{maxLength:100}}}),i.createElement("div",{className:"field"},i.createElement("label",{style:{margin:"auto",paddingLeft:0},htmlFor:"is_active",className:"col-2"},"Is Active?"),i.createElement(v.Qr,{defaultValue:!1,name:"is_active",control:e,render:function(e){var t=e.field;e.fieldState;return i.createElement(y.X,Object.assign({checked:t.value,trueValue:!0,falseValue:!1,id:t.name},t))}})),i.createElement(l.Wi,{label:"Role",name:"role",control:e,errors:r,required:!0,leftSpan:2,rightSpan:4,useExplicit:!0,formItem:{component:g.L,componentProps:{optionGroupTemplate:i.createElement("div",{style:{cursor:"pointer",textAlign:"center",backgroundColor:"#e6e1e1",color:"black",lineHeight:2.5},onClick:function(){return x("/users/roles",{state:{url:O?"/users/users/new":"/users/users/".concat(null===J||void 0===J?void 0:J.id,"/edit"),data:o()}})}},"-- Create And Edit --"),optionLabel:"role",optionValue:"id",optionGroupLabel:"label",optionGroupChildren:"items",options:[{label:"Add",items:(null===N||void 0===N?void 0:N.filter((function(e){var n,r,o,i;return!(null===(n=null===e||void 0===e?void 0:e.role)||void 0===n?void 0:n.toLowerCase().includes("superadmin"))||(null===(i=null===(o=null===(r=t.user)||void 0===r?void 0:r.role[0])||void 0===o?void 0:o.name)||void 0===i?void 0:i.toLowerCase().includes("superadmin"))})))||[]}]}}}),i.createElement(h.u,{mouseTrack:!0,mouseTrackLeft:10,target:"#user-company",position:"top",content:"Can't Be Modified Once Added",className:"my-tooltip"}),(null===(c=null===(u=null===(a=t.user)||void 0===a?void 0:a.role[0])||void 0===u?void 0:u.name)||void 0===c?void 0:c.toLowerCase().includes("superadmin"))&&i.createElement(l.Wi,{label:"Company",name:"company",required:!0,control:e,errors:r,isLoading:D,leftSpan:2,rightSpan:4,formItem:{component:g.L,componentProps:{showClear:!0,optionLabel:"id",optionValue:"id",filter:!0,disabled:!O,id:"user-company",filterBy:"id",options:G}}}))}}))},W=function(e){var t=(0,i.useState)(1),n=(0,p.Z)(t,2),r=n[0],o=n[1],a=(0,i.useState)(b.IV),d=(0,p.Z)(a,2),m=d[0],v=d[1],f=P({page:r,size:m},{refetchOnMountOrArgChange:!0}),g=f.data,y=f.isFetching,h=T(),E=(0,p.Z)(h,2),S=E[0],w=E[1].isLoading;return i.createElement(l.PS,{pagination:{pageSize:m,loading:y,currentPage:r,total:null===g||void 0===g?void 0:g.count,onChange:function(e,t){o(e),v(t)}},baseRoute:"/".concat(u.o,"/").concat(c),description:s,isLoading:y||w,data:null===g||void 0===g?void 0:g.results,deleteAction:function(e){return S(e).unwrap()},newTable:!0,showHeader:!0,navKey:"id",delKey:"id"},i.createElement(l._P,{field:"id",header:"User Code",filteringType:"number"}),i.createElement(l._P,{field:"user_name",header:"User Name",filteringType:"text"}),i.createElement(l._P,{field:"first_name",header:"First Name",filteringType:"text"}),i.createElement(l._P,{field:"phone_number",header:"Phone Number",filteringType:"text"}),i.createElement(l._P,{field:"email",header:"Email",filteringType:"text"}))},J=i.createElement(a.AW,{path:c},i.createElement(a.AW,{path:"new",element:i.createElement(Z,null)}),i.createElement(a.AW,{path:":id/edit",element:i.createElement(Z,null)}),i.createElement(a.AW,{index:!0,element:i.createElement(W,null)})),F=n(4401),V=n(6272),G=n(8356),D=n(6770),z=n(8103),M=n(4576),Q=n(1387),H=n(4756),B=n(7624),K=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(t){i(t)}}function l(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}u((r=r.apply(e,t||[])).next())}))},X=function(){var e=(0,b.aC)(),t=(0,a.s0)(),n=(0,a.TH)().state,r=(0,b.ft)(),o=(0,v.cI)({}),u=o.control,c=o.formState,s=c.errors,d=(c.isDirty,o.register,o.reset,o.handleSubmit),g=o.setValue,y=_(),h=y.data,E=y.isLoading,S=y.refetch,w=A(),x=w.data,L=(w.isLoading,(0,i.useState)([])),T=(0,p.Z)(L,2),I=T[0],P=T[1],C=(0,i.useState)(!0),O=(0,p.Z)(C,2),k=O[0],q=O[1],U=(0,i.useState)(null),Z=(0,p.Z)(U,2),W=Z[0],J=Z[1],X=(0,i.useRef)(null),Y=(0,i.useState)(!1),$=(0,p.Z)(Y,2),ee=($[0],$[1],N()),te=(0,p.Z)(ee,2),ne=te[0],re=te[1].isLoading,oe=j(),ie=(0,p.Z)(oe,2),ae=ie[0],le=ie[1].isLoading,ue=R(),ce=(0,p.Z)(ue,2),se=ce[0],de=(ce[1].isLoading,function(e){return se(e).unwrap()}),me=function(e,t){var n;null===(n=null===X||void 0===X?void 0:X.current)||void 0===n||n.show({severity:"success",summary:e,detail:t,life:3e3})},pe=function(e,t){var n;null===(n=null===X||void 0===X?void 0:X.current)||void 0===n||n.show({severity:"error",summary:e,detail:t,life:3e3})};return E?i.createElement("div",{className:"custom-skeleton p-4"},i.createElement("div",null,i.createElement(V.O,{height:"50px",width:"30%",className:"mb-2"}),i.createElement(V.O,{height:"50px",width:"50%",className:"mb-2"}))):i.createElement(i.Fragment,null,i.createElement(Q.F,{ref:X}),i.createElement(l.Gn,{className:"pl-8",style:{height:"50%",width:"90%"},header:i.createElement("div",{className:"flex"},i.createElement("h3",{className:(0,H.AK)("m-0 my-auto")},"Role")),rowHover:!0,onRowClick:function(e){q(!1),J(e.data),g("role",e.data.role),g("role_description",e.data.role_description),console.log(null===x||void 0===x?void 0:x.filter((function(t){var n,r;return(null===(r=null===(n=e.data)||void 0===n?void 0:n.access)||void 0===r?void 0:r.filter((function(e){return e.id===t.id})).length)>0}))),P(null===x||void 0===x?void 0:x.filter((function(t){var n,r;return(null===(r=null===(n=e.data)||void 0===n?void 0:n.access)||void 0===r?void 0:r.filter((function(e){return e.id===t.id})).length)>0})))},value:h,stripedRows:!0},i.createElement(F.s,{headerStyle:B.jc,style:{maxWidth:"80px"},bodyStyle:{textAlign:"center",overflow:"visible"},body:function(e){return function(t){return i.createElement(i.Fragment,null,i.createElement(D.z,{style:{height:"20px",width:"20px",borderRadius:50},onClick:function(){return e(t.id)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"}))}}((function(e){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(de){t.next=2;break}return t.abrupt("return");case 2:(0,M.V)({message:"Are you sure you want to delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){var n,r;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,de(e);case 3:r=t.sent,me("Success",r),q(!0),J(null),g("role",""),g("role_description",""),P([]),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),pe("Failed",null===(n=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===n?void 0:n.detail);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))},reject:function(){}});case 3:case"end":return t.stop()}}),t)})))}))}),i.createElement(F.s,{headerStyle:B.iR,style:{maxWidth:"200px"},bodyStyle:{cursor:"pointer"},field:"role",header:"Role Name",sortable:!0,filter:!0}),i.createElement(F.s,{headerStyle:B.iR,field:"access_pages",bodyStyle:{cursor:"pointer"},header:"Accessible Pages",body:function(e){return null===e||void 0===e?void 0:e.access.map((function(e){return e.name})).join(",")}})),i.createElement(G.i,null),i.createElement("form",{onSubmit:d((function(e){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){var n,o;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,o=Object.assign(Object.assign({},e),{access:null===I||void 0===I?void 0:I.map((function(e){return e.id})),is_role_active:!0}),!k){t.next=8;break}return t.next=5,ne(Object.assign(Object.assign({},o),r)).unwrap();case 5:n=t.sent,t.next=11;break;case 8:return t.next=10,ae(Object.assign(Object.assign({key:null===W||void 0===W?void 0:W.id},o),r)).unwrap();case 10:n=t.sent;case 11:q(!0),J(null),g("role",""),g("role_description",""),P([]),me("Success",n.detail),S(),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),pe("An error occurred","We couldn't save your request, try again!");case 23:case"end":return t.stop()}}),t,null,[[0,20]])})))}))},i.createElement("div",{className:"flex"},i.createElement("div",{className:"col-1"}),i.createElement("div",{className:"col-7"},function(t,n,r){var o,a,u,c,s;return i.createElement("div",{className:"pl-8"},i.createElement(l.Wi,{label:"Role Name",name:"role",control:t,errors:r,required:!0,leftSpan:4,rightSpan:5,formItem:{component:f.o,componentProps:{maxLength:50,disabled:re||le||"superadmin"===(null===(o=null===W||void 0===W?void 0:W.role)||void 0===o?void 0:o.toLowerCase())}}}),i.createElement(l.Wi,{label:"Description",name:"role_description",control:t,errors:r,required:!0,leftSpan:4,rightSpan:5,formItem:{component:f.o,componentProps:{maxLength:50,disabled:re||le}}}),i.createElement(l.Wi,{label:"Accessible Pages",name:"access",control:t,errors:r,leftSpan:4,rightSpan:5,formItem:{component:z.N,componentProps:{value:I,optionLabel:"permission",onChange:function(e){return P(e.value)},options:x,display:"chip",disabled:re||le||!(null===(c=null===(u=null===(a=e.user)||void 0===a?void 0:a.role[0])||void 0===u?void 0:u.name)||void 0===c?void 0:c.toLowerCase().includes("superadmin"))&&"superadmin"===(null===(s=null===W||void 0===W?void 0:W.role)||void 0===s?void 0:s.toLowerCase()),placeholder:"Select Pages",className:"w-full md:w-20rem"}}}))}(u,0,s)),i.createElement("div",{className:"my-auto"},i.createElement(D.z,{loading:re||le,label:"Save",id:"submit",type:"submit",style:{paddingRight:20},className:"p-button-warning mr-3"}),i.createElement(D.z,{loading:re||le,label:"Clear",style:{paddingRight:20},className:"p-button-warning mr-3",onClick:function(e){return K(void 0,void 0,void 0,(0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),q(!0),J(null),g("role",""),g("role_description",""),P([]);case 6:case"end":return t.stop()}}),t)})))}}),i.createElement(D.z,{loading:re||le,label:"Back",onClick:function(){return t((null===n||void 0===n?void 0:n.url)||"/users/users",{state:n.data})}})))))},Y=i.createElement(a.AW,{path:"roles"},i.createElement(a.AW,{index:!0,element:i.createElement(X,null)})),$=function(){var e,t,n,r,o,u,s=(0,b.aC)();null===(n=null===(t=null===(e=s.user)||void 0===e?void 0:e.role[0])||void 0===t?void 0:t.access)||void 0===n||n.map((function(e){return e.name}));return i.createElement(a.Z5,null,(null===(u=null===(o=null===(r=s.user)||void 0===r?void 0:r.role[0])||void 0===o?void 0:o.name)||void 0===u?void 0:u.toLowerCase().includes("admin"))?i.createElement(a.AW,{path:"/",element:i.createElement(l.SV,{navItems:d})},i.createElement(a.AW,{index:!0,element:i.createElement(a.Fg,{to:c,replace:!0})}),J,Y,i.createElement(a.AW,{path:":page/comming-soon",element:i.createElement(l.hg,null)}),i.createElement(a.AW,{path:"*",element:i.createElement(l.EN,{relative:!0})})):i.createElement(a.AW,{path:"/",element:i.createElement(l.SV,{navItems:d})},i.createElement(a.AW,{path:"*",element:i.createElement(l.Sd,{relative:!0})})))}}}]);
//# sourceMappingURL=526.462c3405.chunk.js.map