"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[386],{1386:function(e,t,n){n.r(t),n.d(t,{default:function(){return le}});var a=n(969),r=n(734),o=n(2035),i=n(3383),l=function(e,t){return(0,o.E7)("/".concat(i.o,"/").concat(e)+(t?"/comming-soon":""))},c=[{items:[{label:"Contract Agreement",icon:"pi ml-3",template:l("contract")},{label:"Sale Agreement",icon:"pi ml-3",template:l("saleagreement")}]}],u=n(2723),s=n(6234),d=n(3665),m=n(7765),p=n(8301),f=n(8224),g=n(3127),v=n(1495),y=n(8079),E="/contract/contractor/",h=v.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listContract:e.query({query:function(e){var t=e.page,n=e.size;return{url:(0,v.DS)(E,"?page=".concat(t||1,"&page_size=").concat(n||v.IV))}},providesTags:function(e){return e?[].concat((0,y.Z)(null===e||void 0===e?void 0:e.results.map((function(e){var t=e.key;return{type:v.pJ.CONTRACT,key:t}}))),[{type:v.pJ.CONTRACT,id:"LIST"}]):[{type:v.pJ.CONTRACT,id:"LIST"}]}}),addContract:e.mutation({query:function(e){return{url:E,method:"POST",body:e}},invalidatesTags:[{type:v.pJ.CONTRACT,id:"LIST"}]}),getContract:e.query({query:function(e){return"".concat(E).concat(e)},providesTags:function(e,t,n){return[{type:v.pJ.CONTRACT,id:n}]}}),updateContract:e.mutation({query:function(e){var t=e;return{url:"".concat(E),method:"POST",body:t}},invalidatesTags:[{type:v.pJ.CONTRACT,id:"LIST"}]}),deleteContract:e.mutation({query:function(e){return{url:"".concat(E).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:v.pJ.CONTRACT,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),S=h.useAddContractMutation,b=h.useDeleteContractMutation,A=h.useGetContractQuery,T=h.useListContractQuery,C=h.useUpdateContractMutation,w=(h.useGetErrorProneQuery,h.endpoints.getContract,n(6770)),L="contract",_="Contract",x=(0,a.forwardRef)((function(e,t){var n=e.data,r=e.isLoading,l=e.disableTable,c=void 0!==l&&l,u=e.onChange,d=void 0===u?function(){}:u,m=(0,a.useState)([]),p=(0,s.Z)(m,2),g=p[0],y=p[1],E=(0,a.useRef)(g),h=(0,a.useRef)([]),S=(0,v.K)({}).data;(0,a.useImperativeHandle)(t,(function(){return{getItems:function(){return g}}})),(0,a.useEffect)((function(){y(n),E.current=n}),[n]),(0,a.useEffect)((function(){h.current=S||[]}),[S]);return a.createElement(o.PS,{baseRoute:"/".concat(i.o,"/").concat(L),description:_,isLoading:r,data:g,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,hideActionColumn:c,actionBodyTemplate:function(e){return a.createElement(w.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=E.current.filter((function(t){return t!==e}));E.current=t,y(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!0,disableAdd:c||!function(e){if(0===e.length)return!0;var t=e[e.length-1];return(null===t||void 0===t?void 0:t.item_descr)&&(null===t||void 0===t?void 0:t.itemuom_key)}(g),newRowDefaults:{netamt:0,qty:0,unitprice:0},OnRowsChanged:function(e){var t=e.map((function(e){return Object.assign(Object.assign({},e),{netamt:e.qty*e.unitprice})}));y(t),E.current=t,d(!0)},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},a.createElement(o._P,{field:"service_descr",header:"Service Description",type:"text",editorType:!c&&"text"}),a.createElement(o._P,{field:"service_qty",header:"Service Quantity",type:"text",editorType:!c&&"text"}),a.createElement(o._P,{field:"itemuom_key",header:"UOM*",displayValueGetter:function(e,t){var n,a;if(!Array.isArray(e)){var r=null===(n=h.current)||void 0===n?void 0:n.filter((function(n){return n.key===e[t]}));return r.length?r[0].descr:null===(a=null===e||void 0===e?void 0:e.items_uoms)||void 0===a?void 0:a.descr}},editorType:!c&&function(e){var t=e.row,n=e.column,r=e.onRowChange;e.onClose;return a.createElement(f.L,{autoFocus:!0,className:"p-inputtext-sm",value:t[n.key],optionLabel:"descr",optionValue:"key",options:h.current,filter:!0,filterBy:"descr",onChange:function(e){var a=Object.assign({},t);a[n.key]=e.value,r(a,!0)},tabIndex:-1})}}),a.createElement(o._P,{field:"unitprice",header:"Rate Per Unit",type:"number",editorType:!c&&"number"}),a.createElement(o._P,{field:"netamt",header:"Service Cost",type:"currency",defaultValue:0,summaryFormatter:function(e){var t,n=e.row;return t=null===n||void 0===n?void 0:n.netamt,a.createElement(o.JK,{value:t||0})}}))})),P=n(6666),N=n(8391),I=(0,a.forwardRef)((function(e,t){var n=e.data,r=e.isLoading,l=e.disableTable,c=void 0!==l&&l,u=e.selectedProject,d=(0,a.useState)([]),m=(0,s.Z)(d,2),p=m[0],f=m[1],g=(0,a.useRef)(p),y=(0,a.useRef)([]),E=(0,v.aM)({id:u},{skip:!u}).data;(0,a.useImperativeHandle)(t,(function(){return{getItems:function(){return p}}})),(0,a.useEffect)((function(){f(n),g.current=n}),[n]),(0,a.useEffect)((function(){y.current=E||[]}),[E]);return a.createElement(a.Fragment,null,a.createElement(o.PS,{baseRoute:"/".concat(i.o,"/").concat(L),description:_,isLoading:r,data:p,newTable:!0,tableLayoutClass:"h-full",hideActionColumn:c,allowFilters:!1,actionBodyTemplate:function(e){return a.createElement(w.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=g.current.filter((function(t){return t!==e}));g.current=t,f(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!0,disableAdd:c||!function(e){if(0===e.length)return!0;var t=e[e.length-1];return(null===t||void 0===t?void 0:t.item_descr)&&(null===t||void 0===t?void 0:t.netamt)}(p),newRowDefaults:{netamt:0},OnRowsChanged:function(e){f(e),g.current=e},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},a.createElement(o._P,{field:"sno",width:"5%",header:"S.No",type:"text"}),a.createElement(o._P,{field:"descr",header:"Service Description",editorType:!c&&"text"}),a.createElement(o._P,{field:"invoiceamt",header:"Invoice Amount",type:"currency",defaultValue:0,editorType:!c&&"currency"}),a.createElement(o._P,{width:"10%",field:"selected",defaultValue:!1,header:"Select",type:"checkbox",editorType:function(e){var t=e.row,n=e.column,r=e.onRowChange,o=e.onClose;return a.createElement(N.X,{style:{width:"100%",display:"flex",margin:"10px auto",justifyContent:"center"},checked:t[n.key],onChange:function(e){r(Object.assign(Object.assign({},t),(0,P.Z)({},n.key,e.checked)),!0),o(!0)},tabIndex:-1})}})),a.createElement(w.z,{label:"Raise",style:{marginLeft:"auto",marginTop:5,display:"flex",width:100},onClick:function(){},className:"p-button-plain"}))})),R=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{c(a.next(e))}catch(t){o(t)}}function l(e){try{c(a.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}c((a=a.apply(e,t||[])).next())}))},k=function(e,t){return e?t?"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()):new Date(e):e},O=function(e){(0,d.Z)(e);var t=(0,o.pm)(),n=t.showSuccess,l=t.showError,c=(0,a.useState)(!1),y=(0,s.Z)(c,2),E=y[0],h=y[1],b=(0,a.useState)({}),T=(0,s.Z)(b,2),w=T[0],_=T[1],P=(0,a.useState)(!1),N=(0,s.Z)(P,2),O=N[0],Z=N[1],j=(0,a.useState)(!1),q=(0,s.Z)(j,2),M=q[0],F=(q[1],(0,a.useState)("")),W=(0,s.Z)(F,2),V=(W[0],W[1]),D=(0,a.useState)("S"),J=(0,s.Z)(D,2),G=J[0],B=(J[1],(0,a.useState)("SAVE")),z=(0,s.Z)(B,2),U=z[0],H=(z[1],(0,r.UO)().id),Q=parseInt(H||""),K=isNaN(Q)||Q<=0,X=(0,a.useRef)(),Y=(0,a.useRef)(),$=(0,a.useRef)(),ee=(0,v.ft)(),te=(0,a.useState)(null),ne=(0,s.Z)(te,2),ae=ne[0],re=ne[1],oe=A(Q,{skip:K}),ie=oe.data,le=oe.isLoading,ce=oe.refetch,ue=(0,v.Gt)("VCN",{skip:!K}),se=ue.data,de=ue.isLoading,me=(0,r.s0)(),pe=(0,v.JB)(),fe=pe.data,ge=pe.isLoading,ve=(0,v.rC)(),ye=ve.data,Ee=ve.isLoading,he=C(),Se=(0,s.Z)(he,2),be=Se[0],Ae=Se[1].isLoading,Te=S(),Ce=(0,s.Z)(Te,2),we=Ce[0],Le=Ce[1].isLoading;(0,a.useEffect)((function(){_(ie||Object.assign(Object.assign({},ee),{contractdate:k(new Date,!0),docid:"VCN",contractno:null===se||void 0===se?void 0:se.next_doc_id,loctyp:"PR"}))}),[ie,se]),(0,a.useEffect)((function(){var e,t;if(ie&&ye){var n=null===ye||void 0===ye?void 0:ye.filter((function(e){return e.key===ie.vend_key}));n&&V(null===(t=null===(e=n[0])||void 0===e?void 0:e.type)||void 0===t?void 0:t.id)}ie&&re(ie.proj_key)}),[ie,ye]);var _e=function(){return["U","R","C"].includes(null===ie||void 0===ie?void 0:ie.docstatus)};return a.createElement(a.Fragment,null,a.createElement(o.Rm,{ref:$,baseRoute:"/".concat(i.o,"/").concat(L),description:"Contract",id:Q,data:w,disableSaveBtn:_e(),isItemsTableChanged:O||M,isUpdating:Le||Ae||E,isLoading:le,onSubmit:function(e){return R(void 0,void 0,void 0,(0,u.Z)().mark((function t(){var a,r,o,c,s,d,m;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=null===(a=X.current)||void 0===a?void 0:a.getItems(),s=null===(r=Y.current)||void 0===r?void 0:r.getItems(),d=Object.assign(Object.assign({},e),{contractdate:(0,v.p6)(e.contractdate,"yyyy-MM-dd"),docstatus:G,action:U,vend_contract_tasks:c,vend_contract_stages:s}),t.prev=3,!K){t.next=10;break}return t.next=7,we(Object.assign(Object.assign({},d),ee)).unwrap();case 7:m=t.sent,t.next=13;break;case 10:return t.next=12,be(Object.assign(Object.assign({},d),ee)).unwrap();case 12:m=t.sent;case 13:ce(),n("Success",m.detail),h(!0),setTimeout((function(){me("/".concat(i.o,"/").concat(L))}),v.P7),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(3),l("An error occurred",(null===(o=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===o?void 0:o.detail)||"We couldn't save your post, try again!");case 22:case"end":return t.stop()}}),t,null,[[3,19]])})))},renderForm:function(e,t,n){var r,i;return a.createElement("div",{className:"pl-4 pt-4 pb-3 grid p-fluid h-full"},a.createElement(o.Wi,{label:"Contract ID",name:"contractno",isLoading:de,className:"col-10 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:8,formItem:{component:p.R,componentProps:{useGrouping:!1,disabled:!0}}}),a.createElement(o.Wi,{label:"Contractor Category",name:"vend_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:Ee,required:"Select a Contractor",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){var t,n,a=null===ye||void 0===ye?void 0:ye.filter((function(t){return t.key===e.value}));a&&V(null===(n=null===(t=a[0])||void 0===t?void 0:t.type)||void 0===n?void 0:n.id)},formItem:{component:f.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:ye}}}),a.createElement(o.Wi,{label:"Contractor Name",name:"vend_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:Ee,required:"Select a Contractor",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){var t,n,a=null===ye||void 0===ye?void 0:ye.filter((function(t){return t.key===e.value}));a&&V(null===(n=null===(t=a[0])||void 0===t?void 0:t.type)||void 0===n?void 0:n.id)},formItem:{component:f.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:ye}}}),a.createElement(o.Wi,{label:"Contract Date",name:"contractdate",className:"col-10 md:col-6",useExplicit:!0,control:e,errors:n,convertValue:k,required:"Select a Date",leftSpan:4,rightSpan:8,formItem:{component:g.f,componentProps:{showIcon:!0,dateFormat:"yy-mm-dd"}}}),a.createElement(o.Wi,{label:"Project",name:"proj_key",className:"col-10 md:col-6",control:e,errors:n,isLoading:ge,required:"Select a Project",leftSpan:4,rightSpan:8,useExplicit:!0,onChange:function(e){re(e.value)},formItem:{component:f.L,componentProps:{showClear:!0,optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:fe}}}),a.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},a.createElement(x,{data:(null===ie||void 0===ie?void 0:ie.vend_contract_tasks)||(null===(r=X.current)||void 0===r?void 0:r.getItems())||[],isLoading:le,ref:X,disableTable:_e(),onChange:function(e){return!O&&Z(e)}})),a.createElement(o.Wi,{label:"Total Contract Amount",name:"contractamt",leftSpan:4,rightSpan:8,className:"col-10 md:col-6",control:e,errors:n,formItem:{component:m.o,componentProps:{disabled:!0,maxLength:25}}}),a.createElement(o.Wi,{label:"Description",name:"notes",className:"col-12 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:8,formItem:{component:m.o,componentProps:{maxLength:255}}}),a.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},a.createElement(I,{data:(null===ie||void 0===ie?void 0:ie.vend_contract_stages)||(null===(i=Y.current)||void 0===i?void 0:i.getItems())||[],isLoading:le,ref:Y,selectedProject:ae,disableTable:_e()})))}}))},Z=n(8356),j=function(e){var t=(0,a.useState)(1),n=(0,s.Z)(t,2),r=n[0],l=n[1],c=(0,a.useState)(v.IV),u=(0,s.Z)(c,2),d=u[0],m=u[1],p=(0,a.useState)(null),g=(0,s.Z)(p,2),y=g[0],E=g[1],h=(0,v.JB)().data,S=T({page:r,size:d},{refetchOnMountOrArgChange:!0}),A=S.data,C=S.isFetching,w=b(),_=(0,s.Z)(w,2),x=_[0],P=_[1].isLoading;return a.createElement(a.Fragment,null,a.createElement(Z.i,null),a.createElement("div",{className:"pl-5"},a.createElement("div",{className:"field"},a.createElement("label",{className:"col-2"},"Project Name"),a.createElement(f.L,{style:{width:"30%"},optionLabel:"name",optionValue:"key",value:y,filter:!0,filterBy:"name",onChange:function(e){E(e.value)},options:h}))),a.createElement(o.PS,{pagination:{pageSize:d,loading:C,currentPage:r,total:null===A||void 0===A?void 0:A.count,onChange:function(e,t){l(e),m(t)}},baseRoute:"/".concat(i.o,"/").concat(L),description:"Contract Agreement",isLoading:C||P,data:null===A||void 0===A?void 0:A.results,deleteAction:function(e){return x(e).unwrap()},newTable:!0,showHeader:!0},a.createElement(o._P,{field:"contractno",header:"Contract No",filteringType:"number"}),a.createElement(o._P,{field:"contractdate",header:"Contract Date",filteringType:"date"}),a.createElement(o._P,{field:"vendor.name",header:"Contractor",filteringType:"text"}),a.createElement(o._P,{field:"status.descr",header:"Status",filteringType:"text"})))},q=a.createElement(r.AW,{path:"contract"},a.createElement(r.AW,{path:"new",element:a.createElement(O,null)}),a.createElement(r.AW,{path:":id/edit",element:a.createElement(O,null)}),a.createElement(r.AW,{index:!0,element:a.createElement(j,null)})),M=n(3953),F=n(4756),W=n(8103),V=n(6098),D="/sale/agreement/",J=v.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listSaleAgreement:e.query({query:function(e){var t=e.page,n=e.size;return{url:(0,v.DS)(D,"?page=".concat(t||1,"&page_size=").concat(n||v.IV))}},providesTags:function(e){var t;return e?[].concat((0,y.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.key;return{type:v.pJ.SALE_AGREEMENT,key:t}}))),[{type:v.pJ.SALE_AGREEMENT,id:"LIST"}]):[{type:v.pJ.SALE_AGREEMENT,id:"LIST"}]}}),addSaleAgreement:e.mutation({query:function(e){return{url:D,method:"POST",body:e}},invalidatesTags:[{type:v.pJ.SALE_AGREEMENT,id:"LIST"}]}),getSaleAgreement:e.query({query:function(e){return"".concat(D).concat(e)},providesTags:function(e,t,n){return[{type:v.pJ.SALE_AGREEMENT,id:n}]}}),updateSaleAgreement:e.mutation({query:function(e){var t=e;return{url:"".concat(D),method:"POST",body:t}},invalidatesTags:function(e){return[{type:v.pJ.SALE_AGREEMENT,id:null===e||void 0===e?void 0:e.key}]}}),deleteSaleAgreement:e.mutation({query:function(e){return{url:"".concat(D).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:v.pJ.SALE_AGREEMENT,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),G=J.useAddSaleAgreementMutation,B=J.useDeleteSaleAgreementMutation,z=J.useGetSaleAgreementQuery,U=J.useListSaleAgreementQuery,H=J.useUpdateSaleAgreementMutation,Q=(J.useGetErrorProneQuery,n(4576)),K="saleagreement",X="Sale Agreement",Y="/sale/agreement/items/",$=v.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listSaleAgreementItem:e.query({query:function(e){var t=e.page,n=e.size;return{url:(0,v.DS)(Y,"?page=".concat(t||1,"&page_size=").concat(n||v.IV))}},providesTags:function(e){var t;return e?[].concat((0,y.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.item_key;return{type:v.pJ.SALE_AGREEMENT_ITEM,item_key:t}}))),[{type:v.pJ.SALE_AGREEMENT_ITEM,id:"LIST"}]):[{type:v.pJ.SALE_AGREEMENT_ITEM,id:"LIST"}]}}),addSaleAgreementItems:e.mutation({query:function(e){return{url:Y,method:"POST",body:e}},invalidatesTags:[{type:v.pJ.SALE_AGREEMENT_ITEM,id:"LIST"},{type:v.pJ.TRANSACTION,id:"LIST"}]}),getSaleAgreementItem:e.query({query:function(e){return"".concat(Y).concat(e)},providesTags:function(e,t,n){return[{type:v.pJ.SALE_AGREEMENT_ITEM,id:n}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),ee=$.useAddSaleAgreementItemsMutation,te=($.useGetSaleAgreementItemQuery,$.useListSaleAgreementItemQuery,$.useGetErrorProneQuery,function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{c(a.next(e))}catch(t){o(t)}}function l(e){try{c(a.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}c((a=a.apply(e,t||[])).next())}))}),ne=(0,a.forwardRef)((function(e,t){var n=e.data,r=e.isLoading,i=e.disableTable,l=void 0!==i&&i,c=e.onChange,d=void 0===c?function(){}:c,m=(0,a.useState)([]),p=(0,s.Z)(m,2),f=p[0],g=p[1],y=ee(),E=(0,s.Z)(y,2),h=E[0],S=E[1].isLoading,b=(0,a.useRef)(f),A=(0,a.useRef)([]),T=(0,a.useRef)([]),C=(0,v.gg)({}).data,L=(0,v.K)({}).data;(0,a.useImperativeHandle)(t,(function(){return{saveItem:function(e){return te(this,void 0,void 0,(0,u.Z)().mark((function t(){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(Object.assign(Object.assign({},e),{items:f})).unwrap();case 2:case"end":return t.stop()}}),t)})))},getItems:function(){return f}}})),(0,a.useEffect)((function(){g(n),b.current=n}),[n]),(0,a.useEffect)((function(){A.current=C||[],T.current=L||[]}),[C,L]);var _=function(e){return a.createElement(w.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){(0,Q.V)({message:"Are you sure you want to Delete Item?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){return function(e){var t=b.current.filter((function(t){return t!==e}));b.current=t,g(t)}(e)},reject:function(){}})},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},x=function(e){if(0===e.length)return!0;var t=e[e.length-1];return null===t||void 0===t?void 0:t.item_descr},P=function(e){return a.createElement(o.JK,{value:e||0})};return a.createElement(a.Fragment,null,a.createElement(o.PS,{baseRoute:"/sales/".concat(K),description:X,isLoading:r||S,data:f,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,hideActionColumn:l,actionBodyTemplate:_,gridProps:{allowAdd:!0,disableAdd:l||!x(f),newRowDefaults:{netamt:0},OnRowsChanged:function(e){g(e),b.current=e,d(!0)},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},a.createElement(o._P,{field:"item_descr",width:"70%",header:"Payment Stages*",editorType:!l&&"text"}),a.createElement(o._P,{field:"netamt",header:"Total Amt",type:"currency",defaultValue:0,editorType:!l&&"currency",summaryFormatter:function(e){var t=e.row;return P(null===t||void 0===t?void 0:t.netamt)}})),a.createElement("div",null),a.createElement(o.PS,{baseRoute:"/sales/".concat(K),description:X,isLoading:r||S,data:f,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,hideActionColumn:l,actionBodyTemplate:_,gridProps:{allowAdd:!0,disableAdd:l||!x(f),newRowDefaults:{netamt:0},OnRowsChanged:function(e){g(e),b.current=e,d(!0)},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},a.createElement(o._P,{field:"item_descr",width:"70%",header:"Payment Stages*",editorType:!l&&"text"}),a.createElement(o._P,{field:"netamt",header:"Total Amt",type:"currency",defaultValue:0,editorType:!l&&"currency",summaryFormatter:function(e){var t=e.row;return P(null===t||void 0===t?void 0:t.netamt)}})))})),ae=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{c(a.next(e))}catch(t){o(t)}}function l(e){try{c(a.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}c((a=a.apply(e,t||[])).next())}))},re=function(e){var t=(0,o.pm)(),n=t.showSuccess,i=t.showError,l=(0,a.useState)(!1),c=(0,s.Z)(l,2),d=c[0],p=c[1],f=(0,a.useState)(!1),y=(0,s.Z)(f,2),E=y[0],h=y[1],S=(0,a.useState)("S"),b=(0,s.Z)(S,2),A=b[0],T=b[1],C=(0,a.useState)("SAVE"),L=(0,s.Z)(C,2),_=L[0],x=L[1],P=(0,r.s0)(),N=(0,r.UO)().id,I=parseInt(N||""),R=isNaN(I)||I<=0,k=(0,a.useRef)(),O=(0,a.useRef)(),Z=(0,v.ft)(),j=z(I,{skip:R,refetchOnMountOrArgChange:!0}),q=j.data,D=j.isLoading,J=(0,a.useState)(null),B=(0,s.Z)(J,2),U=B[0],Q=B[1],K=(0,a.useState)(null),X=(0,s.Z)(K,2),Y=X[0],$=X[1],ee=(0,a.useState)([]),te=(0,s.Z)(ee,2),re=te[0],oe=te[1],ie=(0,a.useState)({}),le=(0,s.Z)(ie,2),ce=le[0],ue=le[1],se=(0,v.Gt)("SLA",{skip:!R,refetchOnMountOrArgChange:R}),de=se.data,me=(se.isFetching,(0,v.Nn)()),pe=me.data,fe=me.isLoading,ge=(0,v.Xj)(),ve=(ge.data,ge.isLoading,G()),ye=(0,s.Z)(ve,2),Ee=ye[0],he=ye[1].isLoading,Se=H(),be=(0,s.Z)(Se,2),Ae=be[0],Te=be[1].isLoading;(0,a.useEffect)((function(){var e,t,n,a;ue(q||Object.assign(Object.assign({},Z),{agreementdate:(0,v.Hh)(new Date,!0),docid:"SLA",agreementno:null===de||void 0===de?void 0:de.next_doc_id,loctyp:"PR"})),q&&(oe((null===q||void 0===q?void 0:q.stages)||[]),Q(null===(t=null===(e=null===q||void 0===q?void 0:q.booking)||void 0===e?void 0:e.project)||void 0===t?void 0:t.name),$(null===(a=null===(n=null===q||void 0===q?void 0:q.booking)||void 0===n?void 0:n.unit)||void 0===a?void 0:a.descr))}),[q]);var Ce=function(){return["U","R","C"].includes(null===q||void 0===q?void 0:q.docstatus)};return a.createElement(a.Fragment,null,a.createElement(o.Rm,{disableSaveBtn:Ce(),baseRoute:"/sales/saleagreement",description:"Sale Agreement",id:I,data:ce,isUpdating:he||Te||d,ref:O,isItemsTableChanged:E,moreSubmitItems:a.createElement(a.Fragment,null,a.createElement(w.z,{label:"Submit",style:{margin:"0 20px"},disabled:"S"!==(null===q||void 0===q?void 0:q.docstatus),onClick:function(e){e.preventDefault(),function(e,t){ae(void 0,void 0,void 0,(0,u.Z)().mark((function n(){var a;return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,T(e);case 2:return n.next=4,x(t);case 4:null===(a=document.getElementById("submit"))||void 0===a||a.click();case 5:case"end":return n.stop()}}),n)})))}("U","SUBMIT_WITH_SAVE")}}),a.createElement(w.z,{label:"Cancel",disabled:R||["R","C"].includes(null===q||void 0===q?void 0:q.docstatus),className:"p-button-plain",onClick:function(e){return x("CANCEL"),T("C"),!0}})),isLoading:D,onSubmit:function(e){return ae(void 0,void 0,void 0,(0,u.Z)().mark((function t(){var a,r,o,l,c;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,l=null===(a=k.current)||void 0===a?void 0:a.getItems(),c=Object.assign(Object.assign({},e),{docid:"SLA",agreementno:R?null===de||void 0===de?void 0:de.next_doc_id:null===q||void 0===q?void 0:q.agreementno,agreementdate:(0,v.p6)(e.agreementdate,"yyyy-MM-dd"),loctyp:"PR",docstatus:A,action:_,stages:l}),!R){t.next=9;break}return t.next=6,Ee(Object.assign(Object.assign({},c),Z)).unwrap();case 6:o=t.sent,t.next=12;break;case 9:return t.next=11,Ae(Object.assign(Object.assign(Object.assign({},c),Z),{key:null===q||void 0===q?void 0:q.key})).unwrap();case 11:o=t.sent;case 12:n("Success",o.detail),p(!0),setTimeout((function(){P("/sales/saleagreement")}),v.P7),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),i("An error occurred",(null===(r=null===t.t0||void 0===t.t0?void 0:t.t0.data)||void 0===r?void 0:r.detail)||"We couldn't save your post, try again!");case 20:case"end":return t.stop()}}),t,null,[[0,17]])})))},renderForm:function(e,t,n,r){var i;return a.createElement("div",{className:"pl-4 pt-4 grid p-fluid h-full"},a.createElement(o.Wi,{label:"Agreement No",name:"number",className:"col-12",control:e,errors:n,leftSpan:2,rightSpan:3,formItem:{component:m.o,componentProps:{useGrouping:!1,disabled:!0,value:(null===q||void 0===q?void 0:q.agreementno)||(null===de||void 0===de?void 0:de.next_doc_id)}}}),a.createElement(o.Wi,{label:"Customer",name:"cust_key",className:"col-12 md:col-6",control:e,errors:n,isLoading:fe,required:!0,leftSpan:4,rightSpan:6,formItem:{component:W.N,componentProps:{value:[],optionLabel:"name",options:pe,display:"chip",placeholder:"Select Customers",className:"w-full md:w-20rem"}}}),a.createElement(o.Wi,{label:"Agreement Date",name:"agreementdate",className:"col-12 md:col-6",useExplicit:!0,control:e,errors:n,required:!0,leftSpan:4,rightSpan:6,convertValue:v.Hh,formItem:{component:g.f,componentProps:{showIcon:!0,dateFormat:"yy-mm-dd"}}}),a.createElement("div",{className:"field grid grid-nogutter p-fluid col-12 md:col-6"},a.createElement("label",{htmlFor:"saleamt",style:{marginRight:3},className:(0,F.AK)("col-4",{"p-error":n.saleamt})},"Sale Amount*"),a.createElement("div",{className:"input-field",style:{width:"49%"}},a.createElement(M.Qr,{name:"saleamt",control:e,rules:{required:{value:!0,message:"Enter Sale Amount"}},render:function(e){var t=e.field;return a.createElement(V.h3,Object.assign({id:t.name,maxLength:12,thousandSeparator:!0},t,{style:{width:"100%",textAlign:"right"},onValueChange:function(e){t.onChange(parseInt(e.value))},className:(0,F.AK)("p-inputtext p-component")}))}}),(0,o.Hb)(null===(i=null===n||void 0===n?void 0:n.saleamt)||void 0===i?void 0:i.message))),a.createElement(o.Wi,{label:"Project",name:"proj_key",className:"col-12 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:6,formItem:{component:m.o,componentProps:{value:U}}}),a.createElement(o.Wi,{label:"Unit",name:"projunit_key",className:"col-12 md:col-6",control:e,errors:n,leftSpan:4,rightSpan:6,formItem:{component:m.o,componentProps:{disabled:!0,value:Y}}}),a.createElement(o.Wi,{label:"Notes",name:"notes",leftSpan:2,rightSpan:8,className:"pb-3 col-12",control:e,errors:n,formItem:{component:m.o,componentProps:{maxLength:25}}}),a.createElement("div",{className:"col-12"},a.createElement(ne,{data:re,isLoading:D,ref:k,disableTable:Ce(),onChange:function(e){return!E&&h(e)}})))}}))},oe=function(e){var t=(0,a.useState)(1),n=(0,s.Z)(t,2),r=n[0],i=n[1],l=(0,a.useState)(v.IV),c=(0,s.Z)(l,2),u=c[0],d=c[1],m=(0,a.useState)(null),p=(0,s.Z)(m,2),g=p[0],y=p[1],E=(0,v.JB)().data,h=U({page:r,size:u}),S=h.data,b=h.isFetching,A=B(),T=(0,s.Z)(A,2),C=T[0],w=T[1].isLoading;return a.createElement(a.Fragment,null,a.createElement(Z.i,null),a.createElement("div",{className:"pl-5"},a.createElement("div",{className:"field"},a.createElement("label",{className:"col-2"},"Project Name"),a.createElement(f.L,{style:{width:"30%"},optionLabel:"name",optionValue:"key",value:g,filter:!0,filterBy:"name",onChange:function(e){y(e.value)},options:E}))),a.createElement(o.PS,{pagination:{pageSize:u,loading:b,currentPage:r,total:null===S||void 0===S?void 0:S.count,onChange:function(e,t){i(e),d(t)}},baseRoute:"/contract_agreement/saleagreement",description:"Sale Agreement",isLoading:b||w,data:null===S||void 0===S?void 0:S.results,newTable:!0,showHeader:!0,deleteAction:function(e){return C(e).unwrap()}},a.createElement(o._P,{field:"agreementno",header:"Agreement No",filteringType:"number"}),a.createElement(o._P,{field:"agreementdate",header:"Agreement Date",filteringType:"date"}),a.createElement(o._P,{field:"customer.name",header:"Customer",filteringType:"text"}),a.createElement(o._P,{field:"booking.unit.descr",header:"Unit",filteringType:"text"}),a.createElement(o._P,{field:"status.descr",header:"Status",filteringType:"text"})))},ie=a.createElement(r.AW,{path:"saleagreement"},a.createElement(r.AW,{path:"new",element:a.createElement(re,null)}),a.createElement(r.AW,{path:":id/edit",element:a.createElement(re,null)}),a.createElement(r.AW,{index:!0,element:a.createElement(oe,null)})),le=function(){var e,t,n;null===(n=null===(t=null===(e=(0,v.aC)().user)||void 0===e?void 0:e.role[0])||void 0===t?void 0:t.access)||void 0===n||n.map((function(e){return e.name}));return a.createElement(r.Z5,null,a.createElement(r.AW,{path:"/",element:a.createElement(o.SV,{navItems:c})},a.createElement(r.AW,{index:!0,element:a.createElement(r.Fg,{to:L,replace:!0})}),q,ie,a.createElement(r.AW,{path:":page/comming-soon",element:a.createElement(o.hg,null)}),a.createElement(r.AW,{path:"*",element:a.createElement(o.EN,{relative:!0})})))}}}]);
//# sourceMappingURL=386.5163f09b.chunk.js.map