"use strict";(self.webpackChunkbuild_iq_app=self.webpackChunkbuild_iq_app||[]).push([[402],{402:function(e,t,n){n.d(t,{h:function(){return I},Z:function(){return P}});var r=n(969),a=n(734),o=n(2723),i=n(6234),c=n(7765),u=n(8301),l=n(8224),s=n(4756),d=n(3127),m=n(6770),p=n(4576),f=n(55),v=n(6593),g=n(8079),y="/transaction/goods/receipts/",b=v.hi.injectEndpoints({overrideExisting:!1,endpoints:function(e){return{listTransaction:e.query({query:function(e){var t=e.page,n=e.size,r=e.grn;return{url:r?(0,v.DS)(y,"?page=".concat(t||1,"&page_size=").concat(n||v.IV,"&docid=").concat(r)):(0,v.DS)(y,"?page=".concat(t||1,"&page_size=").concat(n||v.IV))}},providesTags:function(e){var t;return e?[].concat((0,g.Z)(null===(t=null===e||void 0===e?void 0:e.results)||void 0===t?void 0:t.map((function(e){var t=e.key;return{type:v.pJ.TRANSACTION,key:t}}))),[{type:v.pJ.TRANSACTION,id:"LIST"}]):[{type:v.pJ.TRANSACTION,id:"LIST"}]}}),addTransaction:e.mutation({query:function(e){return{url:"".concat(y),method:"POST",body:e}},invalidatesTags:[{type:v.pJ.TRANSACTION,id:"LIST"}]}),getTransaction:e.query({query:function(e){return"".concat(y).concat(e)},providesTags:function(e,t,n){return[{type:v.pJ.TRANSACTION,id:n}]}}),getTransactionNextDocId:e.query({query:function(e){return"".concat("/transaction/doc/id/","next?docid=").concat(e)},providesTags:function(e,t){return[]}}),updateTransaction:e.mutation({query:function(e){var t=e;return{url:"".concat(y),method:"POST",body:t}},invalidatesTags:function(e){var t;return[{type:v.pJ.TRANSACTION,id:null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.key}]}}),deleteTransaction:e.mutation({query:function(e){return{url:"".concat(y).concat(e),method:"DELETE"}},invalidatesTags:function(e){return[{type:v.pJ.TRANSACTION,id:null===e||void 0===e?void 0:e.id}]}}),getErrorProne:e.query({query:function(){return"error-prone"}})}}}),h=b.useAddTransactionMutation,E=b.useDeleteTransactionMutation,T=b.useGetTransactionQuery,S=b.useListTransactionQuery,N=b.useUpdateTransactionMutation,x=(b.useGetErrorProneQuery,b.useGetTransactionNextDocIdQuery),I=(b.endpoints.getTransaction,"materialpurchase"),_="Material Received",k={purchase:"GR2",inventory:"GR3",projects:"GR1"},w=(0,r.forwardRef)((function(e,t){var n,a=e.moduleName,o=e.data,c=e.isLoading,u=e.disableTable,s=void 0!==u&&u,d=e.onChange,p=void 0===d?function(){}:d,g=(0,r.useState)([]),y=(0,i.Z)(g,2),b=y[0],h=y[1],E=(0,v.nq)("admin"),T=E.data,S=(E.isLoading,T&&(null===(n=T[0])||void 0===n?void 0:n.user)),N=(0,r.useRef)(b),x=(0,r.useRef)([]),k=(0,r.useRef)([]),w=(0,v.Zp)({}),L=w.data,R=(w.isLoading,(0,v.DY)({})),C=R.data;R.isLoading;(0,r.useImperativeHandle)(t,(function(){return{getItems:function(){return b}}})),(0,r.useEffect)((function(){h(o),N.current=o}),[o]),(0,r.useEffect)((function(){x.current=(null===L||void 0===L?void 0:L.results)||[],k.current=(null===C||void 0===C?void 0:C.results)||[]}),[L,C]);var A=function(e){return r.createElement(f.JK,{value:e||0})},P=function(){return"projects"!==a||3===S};return r.createElement(f.PS,{baseRoute:"/".concat(a,"/").concat(I),description:_,isLoading:c,data:b,newTable:!0,tableLayoutClass:"h-full",allowFilters:!1,hideActionColumn:s,actionBodyTemplate:function(e){return r.createElement(m.z,{style:{height:"35px",width:"20px",marginLeft:20},type:"button",onClick:function(){return function(e){var t=N.current.filter((function(t){return t!==e}));N.current=t,h(t)}(e)},className:"p-button-rounded p-button-text",icon:"pi pi-trash"})},gridProps:{allowAdd:!s&&(0,v.pH)(b),newRowDefaults:{netamt:0,taxamt:0,totalamt:0},OnRowsChanged:function(e){var t=e.map((function(e){return Object.assign(Object.assign({},e),{netamt:e.qty*e.unitprice,totalamt:e.qty*e.unitprice+e.taxamt})}));h(t),N.current=t,p(!0)},getBottomSummaryRows:function(e){return[{netamt:e.map((function(e){return parseFloat(e.netamt||0)})).reduce((function(e,t){return e+t}),0),taxamt:e.map((function(e){return parseFloat(e.taxamt||0)})).reduce((function(e,t){return e+t}),0),totalamt:e.map((function(e){return parseFloat(e.totalamt||0)})).reduce((function(e,t){return e+t}),0)}]}}},r.createElement(f._P,{field:"item_key",header:"Item",displayValueGetter:function(e,t){var n,r;if(!Array.isArray(e)){var a=null===(n=x.current)||void 0===n?void 0:n.filter((function(n){return n.key===e[t]}));return a.length?a[0].descr:null===(r=null===e||void 0===e?void 0:e.items)||void 0===r?void 0:r.descr}},editorType:!s&&function(e){var t=e.row,n=e.column,a=e.onRowChange;e.onClose;return r.createElement(l.L,{autoFocus:!0,className:"p-inputtext-sm editor-dropdown-style",value:t[n.key],optionLabel:"descr",optionValue:"key",filter:!0,filterBy:"descr",options:x.current,onChange:function(e){var r=Object.assign({},t);r[n.key]=e.value,r.items=k.current.find((function(t){return t.key===e.value})),a(r,!0)},tabIndex:-1})}}),r.createElement(f._P,{field:"itemuom_key",header:"UOM",displayValueGetter:function(e,t){var n,r;if(!Array.isArray(e)){var a=null===(n=k.current)||void 0===n?void 0:n.filter((function(n){return n.key===e[t]}));return a.length?a[0].descr:null===(r=null===e||void 0===e?void 0:e.items_uoms)||void 0===r?void 0:r.descr}},editorType:!s&&function(e){var t=e.row,n=e.column,a=e.onRowChange;e.onClose;return r.createElement(l.L,{autoFocus:!0,className:"p-inputtext-sm editor-dropdown-style",value:t[n.key],optionLabel:"descr",optionValue:"key",filter:!0,filterBy:"descr",options:k.current,onChange:function(e){var r=Object.assign({},t);r[n.key]=e.value,r.items_uoms=k.current.find((function(t){return t.key===e.value})),a(r,!0)},tabIndex:-1})}}),r.createElement(f._P,{field:"qty",header:"Quantiy",type:"number",editorType:!s&&"number"}),P()&&r.createElement(f._P,{field:"unitprice",header:"Unit Price",type:"number",editorType:!s&&"number"}),P()&&r.createElement(f._P,{field:"netamt",header:"Net Amt",type:"currency",defaultValue:0,summaryFormatter:function(e){var t=e.row;return A(null===t||void 0===t?void 0:t.netamt)}}),P()&&r.createElement(f._P,{field:"taxamt",header:"Tax Amt",type:"currency",defaultValue:0,editorType:!s&&"currency",summaryFormatter:function(e){var t=e.row;return A(null===t||void 0===t?void 0:t.taxamt)}}),P()&&r.createElement(f._P,{field:"totalamt",header:"Total Amt",type:"currency",defaultValue:0,summaryFormatter:function(e){var t=e.row;return A(null===t||void 0===t?void 0:t.totalamt)}}))})),L=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(t){o(t)}}function c(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},R=function(e,t){return e?t?"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()):new Date(e):e},C=function(e){var t=e.moduleName,n=(0,f.pm)(),g=n.showSuccess,y=n.showError,b=(0,r.useState)(!1),E=(0,i.Z)(b,2),S=E[0],C=E[1],A=(0,r.useState)({}),P=(0,i.Z)(A,2),O=P[0],j=P[1],V=(0,a.UO)().id,q=parseInt(V||""),Z=isNaN(q)||q<=0,D=(0,r.useState)(!1),W=(0,i.Z)(D,2),F=W[0],G=W[1],U=(0,r.useState)("S"),B=(0,i.Z)(U,2),M=B[0],J=B[1],H=(0,r.useState)("SAVE"),Y=(0,i.Z)(H,2),z=Y[0],Q=Y[1],$=(0,r.useState)(null),K=(0,i.Z)($,2),X=K[0],ee=K[1],te=(0,r.useState)(null),ne=(0,i.Z)(te,2),re=ne[0],ae=ne[1],oe=(0,r.useRef)(),ie=(0,r.useRef)(),ce=T(q,{skip:Z}),ue=ce.data,le=ce.isLoading,se=ce.refetch,de=x(k[t],{skip:!Z}),me=de.data,pe=de.isLoading,fe=(0,a.s0)(),ve=(0,v.JB)(),ge=ve.data,ye=ve.isLoading,be=(0,v.Wv)(),he=be.data,Ee=be.isLoading,Te=(0,v.es)({vendor:X,project:re},{skip:!re||!X}),Se=Te.data,Ne=Te.isFetching,xe=N(),Ie=(0,i.Z)(xe,2),_e=Ie[0],ke=Ie[1].isLoading,we=h(),Le=(0,i.Z)(we,2),Re=Le[0],Ce=Le[1].isLoading;(0,r.useEffect)((function(){j(ue||Object.assign(Object.assign({},v.Y$),{date:R(new Date,!0),docid:k[t],number:null===me||void 0===me?void 0:me.next_doc_id,loctyp:"projects"===t?"PR":"inventory"===t?"WH":""})),ue&&(ae(ue.proj_key),ee(ue.vend_key))}),[ue,me]);var Ae=(0,r.useState)(null),Pe=(0,i.Z)(Ae,2),Oe=Pe[0],je=Pe[1],Ve=(0,r.useState)([]),qe=(0,i.Z)(Ve,2),Ze=qe[0],De=qe[1],We=(0,v.dV)({id:Oe},{skip:!Oe}),Fe=We.data;We.isFetching;(0,r.useEffect)((function(){if(Fe)if(console.log(Fe),Z)De(Fe);else{var e=(null===ue||void 0===ue?void 0:ue.grn_items.concat(Fe))||[];De(e)}}),[Fe]),(0,r.useEffect)((function(){ue&&De((null===ue||void 0===ue?void 0:ue.grn_items)||[])}),[ue]);var Ge=function(){return["U","R","I","C"].includes(null===ue||void 0===ue?void 0:ue.docstatus)},Ue=function(e,t){return L(void 0,void 0,void 0,(0,o.Z)().mark((function n(){var r;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,J(e);case 2:return n.next=4,Q(t);case 4:null===(r=document.getElementById("submit"))||void 0===r||r.click();case 5:case"end":return n.stop()}}),n)})))};return r.createElement(r.Fragment,null,r.createElement(f.Rm,{baseRoute:"/".concat(t,"/").concat(I),description:_,id:q,data:O,isItemsTableChanged:F,ref:ie,moreSubmitItems:r.createElement(r.Fragment,null,r.createElement(m.z,{label:"Submit",style:{margin:"0 20px"},disabled:"S"!==(null===ue||void 0===ue?void 0:ue.docstatus),onClick:function(e){var t;e.preventDefault(),(null===(t=ie.current)||void 0===t?void 0:t.getIsDirty())||F?(0,p.V)({message:"Do you want to save the changes before submit?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){return Ue("U","SUBMIT_WITH_SAVE")},reject:function(){return Ue("U","SUBMIT_WITHOUT_SAVE")}}):Ue("U","SUBMIT_WITH_SAVE")}}),r.createElement(m.z,{label:"Cancel",disabled:Z||["R","I","C"].includes(null===ue||void 0===ue?void 0:ue.docstatus),className:"p-button-plain",onClick:function(e){return Q("CANCEL"),J("C"),!0}})),isUpdating:Ce||ke||S,isLoading:le,onSubmit:function(e){return L(void 0,void 0,void 0,(0,o.Z)().mark((function n(){var r,a,i;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=null===(r=oe.current)||void 0===r?void 0:r.getItems(),console.log("submit",e,a),n.prev=2,!Z){n.next=9;break}return n.next=6,Re(Object.assign(Object.assign(Object.assign({},e),{action:z,loctyp:"PR",docstatus:M,grn_items:null===a||void 0===a?void 0:a.map((function(e){return Object.assign(Object.assign({},e),v.Y$)}))}),v.Y$)).unwrap();case 6:i=n.sent,n.next=12;break;case 9:return n.next=11,_e(Object.assign(Object.assign(Object.assign({},e),{action:z,docstatus:M,grn_items:null===a||void 0===a?void 0:a.map((function(e){return Object.assign(Object.assign({},e),v.Y$)}))}),v.Y$)).unwrap();case 11:i=n.sent;case 12:console.log("submit resp",i),se(),g("Success",i.detail),C(!0),setTimeout((function(){fe("/".concat(t,"/").concat(I))}),v.P7),n.next=22;break;case 19:n.prev=19,n.t0=n.catch(2),y("An error occurred","We couldn't save your post, try again!");case 22:case"end":return n.stop()}}),n,null,[[2,19]])})))},renderForm:function(e,n,a){var o;return r.createElement("div",{className:"pl-4 pt-4 grid p-fluid h-full"},r.createElement("div",{className:"col-12 md:col-6 grid grid-nogutter p-fluid",style:{alignContent:"flex-start"}},r.createElement(f.Wi,{label:"Doc Code",name:"docid",className:(0,s.AK)("col-12 md:col-6"),control:e,errors:a,formItem:{component:c.o,componentProps:{disabled:!0}}}),!1),r.createElement(f.Wi,{label:"GRN Number",name:"number",isLoading:pe,className:"col-12 md:col-6",control:e,errors:a,leftSpan:4,rightSpan:6,formItem:{component:u.R,componentProps:{useGrouping:!1,disabled:!0}}}),r.createElement(f.Wi,{label:"Project",name:"proj_key",className:"col-12 md:col-6",control:e,errors:a,required:"Select a Project",isLoading:ye,leftSpan:3,rightSpan:9,useExplicit:!0,onChange:function(e){ae(e.value)},formItem:{component:l.L,componentProps:{optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:ge}}}),r.createElement(f.Wi,{label:"GRN Date",name:"date",className:"col-12 md:col-6",useExplicit:!0,control:e,errors:a,leftSpan:4,rightSpan:6,convertValue:R,formItem:{component:d.f,componentProps:{showIcon:!0,dateFormat:"yy-mm-dd"}}}),r.createElement(f.Wi,{label:"Vendor",name:"vend_key",className:"col-12 md:col-6",control:e,errors:a,isLoading:Ee,required:"Select a Vendor",leftSpan:3,rightSpan:9,useExplicit:!0,onChange:function(e){ee(e.value)},formItem:{component:l.L,componentProps:{optionLabel:"name",optionValue:"key",filter:!0,filterBy:"name",options:he}}}),r.createElement(f.Wi,{label:"PO Number",name:"pono",className:"col-12 md:col-6",control:e,errors:a,leftSpan:4,rightSpan:6,isLoading:Ne,useExplicit:!0,onChange:function(e){Ge()||je(e.value)},formItem:{component:l.L,componentProps:{optionLabel:"number",optionValue:"key",options:Se}}}),r.createElement("div",{className:"col-12 md:col-6"}),r.createElement(f.Wi,{label:"Vendor RefNo",name:"vendrefno",className:"col-12 md:col-6",leftSpan:4,rightSpan:6,required:"Enter Ref No",control:e,errors:a,formItem:{component:c.o,componentProps:{maxLength:25}}}),r.createElement("div",{className:"col-12 ",style:{height:"calc(100% - 183px)",minHeight:200}},r.createElement(w,{data:Ze||(null===(o=oe.current)||void 0===o?void 0:o.getItems())||[],isLoading:le,moduleName:t,ref:oe,disableTable:Ge(),onChange:function(e){return!F&&G(e)}})))}}))},A=function(e){var t=e.moduleName,n=S("purchase"!==t?{grn:k[t]}:{},{refetchOnMountOrArgChange:!0}),a=n.data,o=n.isLoading,c=E(),u=(0,i.Z)(c,2),l=u[0],s=u[1].isLoading;return r.createElement(f.PS,{baseRoute:"/".concat(t,"/").concat(I),description:_,isLoading:o||s,newTable:!0,showHeader:!0,data:null===a||void 0===a?void 0:a.results,deleteAction:function(e){return l(e).unwrap()}},"purchase"===t&&r.createElement(f._P,{field:"docid",header:"Doc Code",filteringType:"text"}),r.createElement(f._P,{field:"number",header:"GRN Number",filteringType:"number"}),r.createElement(f._P,{field:"date",header:"GRN Date",filteringType:"text"}),r.createElement(f._P,{field:"project.name",header:"Project",filteringType:"text"}),r.createElement(f._P,{field:"vendor.name",header:"Vendor",filteringType:"text"}),r.createElement(f._P,{field:"vendrefno",header:"Vendor RefNo",filteringType:"text"}),r.createElement(f._P,{field:"status.descr",header:"GRN Status",filteringType:"text"}))},P=function(e){return r.createElement(a.AW,{path:I},r.createElement(a.AW,{path:"new",element:r.createElement(C,{moduleName:e})}),r.createElement(a.AW,{path:":id/edit",element:r.createElement(C,{moduleName:e})}),r.createElement(a.AW,{index:!0,element:r.createElement(A,{moduleName:e})}))}}}]);
//# sourceMappingURL=402.7ec73e6b.chunk.js.map